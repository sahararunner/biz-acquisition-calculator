{"ast":null,"code":"// Debug logging functions for comprehensive metric tracking\nexport const DEBUG_METRICS = true;\nexport function logMetricCalculation(sectionName, metricName, inputs, formula, result, assumptions = {}) {\n  if (!DEBUG_METRICS) return;\n  console.group(`📊 ${sectionName} - ${metricName}`);\n  console.log(`🔢 INPUTS:`, inputs);\n  console.log(`📐 FORMULA: ${formula}`);\n  console.log(`📋 ASSUMPTIONS:`, assumptions);\n  console.log(`✅ RESULT: ${result}`);\n  console.log(`---`);\n  console.groupEnd();\n}\nexport function logAllMetricsSummary(scenario, metrics) {\n  if (!DEBUG_METRICS) return;\n  console.group(\"📊 DASHBOARD METRICS SUMMARY\");\n  console.log(\"🏢 DEAL STRUCTURE:\");\n  console.log(`  Purchase Price: ${metrics.purchasePrice}`);\n  console.log(`  Available Cash: ${metrics.availableCash}`);\n  console.log(`  Cash Surplus: ${metrics.cashSurplus}`);\n  console.log(`  WACC: ${metrics.wacc}%`);\n  console.log(\"📈 BUSINESS HEALTH:\");\n  console.log(`  DSCR: ${metrics.businessDSCR}x`);\n  console.log(`  ROA: ${metrics.businessROA}%`);\n  console.log(`  Debt/EBITDA: ${metrics.debtToEBITDA}x`);\n  console.log(`  Interest Coverage: ${metrics.interestCoverage}x`);\n  console.log(\"💰 PERSONAL RETURNS:\");\n  console.log(`  Your ROI: ${metrics.yourROI}%`);\n  console.log(`  Cash-on-Cash: ${metrics.cashOnCashReturn}%`);\n  console.log(`  Payback: ${metrics.paybackPeriod} years`);\n  console.log(\"📊 KEY ASSUMPTIONS:\");\n  console.log(`  Target Revenue: ${scenario.targetRevenue}`);\n  console.log(`  Net Profit Margin: ${scenario.netProfitMargin}%`);\n  console.log(`  Valuation Multiple: ${scenario.valuationMultiple}x`);\n  console.log(`  Revenue Growth: ${scenario.revenueGrowthRate}%`);\n  console.log(`  Working Capital %: ${scenario.workingCapitalPercent}%`);\n  console.log(`  Management Salary: ${scenario.managementSalary}`);\n  console.groupEnd();\n}\n\n// SBA loan payment calculation\nexport const calculateSBAPayment = (principal, rate = 0.115, years = 10) => {\n  const monthlyRate = rate / 12;\n  const payments = years * 12;\n  return principal * monthlyRate * Math.pow(1 + monthlyRate, payments) / (Math.pow(1 + monthlyRate, payments) - 1) * 12;\n};\n\n// Seller note payment calculation  \nexport const calculateSellerPayment = (principal, rate = 0.08, years = 5) => {\n  const monthlyRate = rate / 12;\n  const payments = years * 12;\n  return principal * monthlyRate * Math.pow(1 + monthlyRate, payments) / (Math.pow(1 + monthlyRate, payments) - 1) * 12;\n};\n\n// Expected value calculation\nexport const calculateExpectedValue = (scenarios, probabilities) => {\n  return scenarios.bestCase * probabilities.bestCase / 100 + scenarios.mostLikely * probabilities.mostLikely / 100 + scenarios.worstCase * probabilities.worstCase / 100;\n};\n\n// Auto-normalize probabilities\nexport const normalizeProbabilities = (best, likely, worst) => {\n  const total = best + likely + worst;\n  if (total !== 100) {\n    const factor = 100 / total;\n    return {\n      best: Math.round(best * factor),\n      likely: Math.round(likely * factor),\n      worst: Math.round(worst * factor)\n    };\n  }\n  return {\n    best,\n    likely,\n    worst\n  };\n};\n\n// SBA minimum constraint\nexport const validateSBADownPayment = value => Math.max(value, 10);\n\n// Debt service coverage validation\nexport const validateDebtCoverage = (ebitda, debtService) => debtService / ebitda <= 0.8;\n\n// Generate bell curve data\nexport const generateBellCurve = (mean, min, max) => {\n  const stdDev = (max - min) / 6;\n  const points = [];\n  for (let x = min; x <= max; x += (max - min) / 100) {\n    const y = Math.exp(-0.5 * Math.pow((x - mean) / stdDev, 2));\n    points.push({\n      x,\n      y\n    });\n  }\n  return points;\n};\n\n// Calculate total cash required\nexport const calculateTotalCashRequired = params => {\n  const {\n    purchasePrice,\n    sbaDownPaymentPercent,\n    workingCapitalPercent,\n    targetRevenue,\n    techInvestment,\n    sellerFinancingPercent = 20,\n    // Default seller financing percentage\n    dueDiligencePercent = 1.5,\n    professionalFeesPercent = 0.8,\n    contingencyPercent = 2.5\n  } = params;\n\n  // Calculate financing structure correctly\n  const sellerFinancingAmount = purchasePrice * (sellerFinancingPercent / 100);\n  const sbaLoanAmount = purchasePrice - sellerFinancingAmount;\n  const sbaDownPayment = sbaLoanAmount * (sbaDownPaymentPercent / 100);\n\n  // Note: Total financing may exceed purchase price if both SBA and seller financing are used\n  // This is typical in SBA deals where seller financing is additional to SBA loan\n\n  const workingCapital = targetRevenue * (workingCapitalPercent / 100);\n  const dueDiligence = purchasePrice * (dueDiligencePercent / 100);\n  const professionalFees = purchasePrice * (professionalFeesPercent / 100);\n  const contingency = purchasePrice * (contingencyPercent / 100);\n  return {\n    downPayment: sbaDownPayment,\n    workingCapital,\n    dueDiligence,\n    professionalFees,\n    techInvestment,\n    contingency,\n    total: sbaDownPayment + workingCapital + dueDiligence + professionalFees + techInvestment + contingency\n  };\n};\n\n// Calculate annual cash to pocket\nexport const calculateAnnualCashToPocket = params => {\n  const {\n    targetRevenue,\n    netProfitMarginPercent,\n    sbaLoanAmount,\n    sellerFinancingAmount,\n    managementSalary,\n    techInvestment\n  } = params;\n  const ebitda = targetRevenue * (netProfitMarginPercent / 100);\n  const sbaPayment = calculateSBAPayment(sbaLoanAmount);\n  const sellerPayment = calculateSellerPayment(sellerFinancingAmount);\n  const techInvestmentAmortized = techInvestment / 3; // Amortized over 3 years\n\n  return {\n    ebitda,\n    sbaPayment,\n    sellerPayment,\n    managementSalary,\n    techInvestmentAmortized,\n    netCashFlow: ebitda - sbaPayment - sellerPayment - managementSalary - techInvestmentAmortized\n  };\n};\n\n// Calculate Debt Service Coverage Ratio (DSCR)\nexport const calculateDSCR = (annualEBITDA, totalAnnualDebtService) => {\n  const result = totalAnnualDebtService > 0 ? annualEBITDA / totalAnnualDebtService : 0;\n  if (DEBUG_METRICS) {\n    logMetricCalculation(\"Business Health\", \"DSCR (Debt Service Coverage Ratio)\", {\n      annualEBITDA,\n      totalAnnualDebtService\n    }, \"DSCR = Annual EBITDA ÷ Total Annual Debt Service\", result, {\n      interpretation: result >= 1.25 ? \"Strong coverage\" : result >= 1.0 ? \"Adequate coverage\" : \"Weak coverage\",\n      calculation: `${annualEBITDA} ÷ ${totalAnnualDebtService} = ${result}x`\n    });\n  }\n  return result;\n};\n\n// Calculate Cash-on-Cash Return\nexport const calculateCashOnCashReturn = (annualCashToPocket, personalCashInvested) => {\n  const result = personalCashInvested > 0 ? annualCashToPocket / personalCashInvested * 100 : 0;\n  if (DEBUG_METRICS) {\n    logMetricCalculation(\"Personal Returns\", \"Cash-on-Cash Return\", {\n      annualCashToPocket,\n      personalCashInvested\n    }, \"Cash-on-Cash Return = (Annual Cash to Pocket ÷ Personal Cash Invested) × 100\", result, {\n      interpretation: result >= 20 ? \"Excellent return\" : result >= 15 ? \"Good return\" : result >= 10 ? \"Fair return\" : \"Poor return\",\n      calculation: `(${annualCashToPocket} ÷ ${personalCashInvested}) × 100 = ${result}%`\n    });\n  }\n  return result;\n};\n\n// Calculate IRR using Newton-Raphson method\nexport const calculateIRR = (personalInvestment, cashFlows) => {\n  const tolerance = 0.0001;\n  const maxIterations = 100;\n  let guess = 0.1; // Start with 10%\n\n  for (let i = 0; i < maxIterations; i++) {\n    let npv = -personalInvestment;\n    let derivative = 0;\n    for (let j = 0; j < cashFlows.length; j++) {\n      const discountFactor = Math.pow(1 + guess, j + 1);\n      npv += cashFlows[j] / discountFactor;\n      derivative -= (j + 1) * cashFlows[j] / (discountFactor * (1 + guess));\n    }\n    const newGuess = guess - npv / derivative;\n    if (Math.abs(newGuess - guess) < tolerance) {\n      const result = newGuess * 100; // Return as percentage\n\n      if (DEBUG_METRICS) {\n        logMetricCalculation(\"Personal Returns\", \"IRR (Internal Rate of Return)\", {\n          personalInvestment,\n          cashFlows,\n          iterations: i + 1\n        }, \"IRR = Rate where NPV = 0 (calculated using Newton-Raphson method)\", result, {\n          method: \"Newton-Raphson iteration\",\n          tolerance: tolerance,\n          maxIterations: maxIterations,\n          interpretation: result >= 15 ? \"Excellent return\" : result >= 10 ? \"Good return\" : result >= 5 ? \"Fair return\" : \"Poor return\"\n        });\n      }\n      return result;\n    }\n    guess = newGuess;\n  }\n  if (DEBUG_METRICS) {\n    logMetricCalculation(\"Personal Returns\", \"IRR (Internal Rate of Return)\", {\n      personalInvestment,\n      cashFlows\n    }, \"IRR = Rate where NPV = 0 (calculated using Newton-Raphson method)\", null, {\n      method: \"Newton-Raphson iteration\",\n      tolerance: tolerance,\n      maxIterations: maxIterations,\n      error: \"No convergence - IRR calculation failed\"\n    });\n  }\n  return null; // No convergence\n};\n\n// Calculate Multiple on Invested Capital (MOIC)\nexport const calculateMOIC = (personalCashInvested, fiveYearProjections) => {\n  const totalCashReturned = fiveYearProjections.reduce((sum, year) => sum + year.cashFlow, 0);\n  const businessValueAtExit = fiveYearProjections[4].ebitda * 4.2; // Assume same multiple\n  const result = (totalCashReturned + businessValueAtExit) / personalCashInvested;\n  if (DEBUG_METRICS) {\n    logMetricCalculation(\"Personal Returns\", \"MOIC (Multiple on Invested Capital)\", {\n      personalCashInvested,\n      totalCashReturned,\n      businessValueAtExit,\n      year5EBITDA: fiveYearProjections[4].ebitda,\n      exitMultiple: 4.2\n    }, \"MOIC = (Total Cash Returned + Business Value at Exit) ÷ Personal Cash Invested\", result, {\n      exitMultipleSource: \"Assumed 4.2x EBITDA exit multiple\",\n      calculation: `(${totalCashReturned} + ${businessValueAtExit}) ÷ ${personalCashInvested} = ${result}x`\n    });\n  }\n  return result;\n};\n\n// Calculate Payback Period\nexport const calculatePaybackPeriod = (personalCashInvested, fiveYearProjections) => {\n  let cumulativeCashFlow = 0;\n  let result = '>5 years';\n  for (let i = 0; i < fiveYearProjections.length; i++) {\n    cumulativeCashFlow += fiveYearProjections[i].cashFlow;\n    if (cumulativeCashFlow >= personalCashInvested) {\n      result = i + 1 + (personalCashInvested - (cumulativeCashFlow - fiveYearProjections[i].cashFlow)) / fiveYearProjections[i].cashFlow;\n      break;\n    }\n  }\n  if (DEBUG_METRICS) {\n    logMetricCalculation(\"Personal Returns\", \"Payback Period\", {\n      personalCashInvested,\n      cumulativeCashFlow,\n      fiveYearProjections: fiveYearProjections.map(p => ({\n        year: p.year,\n        cashFlow: p.cashFlow\n      }))\n    }, \"Payback Period = Years until cumulative cash flow exceeds personal investment\", result, {\n      interpretation: typeof result === 'number' ? `${result} years to recover investment` : \"Investment not recovered within 5 years\",\n      calculation: `Cumulative cash flow: ${cumulativeCashFlow} vs Personal Investment: ${personalCashInvested}`\n    });\n  }\n  return result;\n};\n\n// Enhanced Risk Score Calculation\nexport const calculateEnhancedRiskScore = (dscr, cashOnCash, sellerFinancingPercent) => {\n  let score = 5; // Base score\n\n  // DSCR scoring\n  if (dscr >= 1.5) score += 2;else if (dscr >= 1.25) score += 1;else score -= 2;\n\n  // Cash-on-Cash scoring\n  if (cashOnCash >= 20) score += 2;else if (cashOnCash >= 15) score += 1;else if (cashOnCash < 10) score -= 1;\n\n  // Seller financing scoring\n  if (sellerFinancingPercent >= 20) score += 1; // Seller has skin in game\n\n  const result = Math.max(1, Math.min(10, score));\n  if (DEBUG_METRICS) {\n    logMetricCalculation(\"Risk Assessment\", \"Enhanced Risk Score\", {\n      dscr,\n      cashOnCash,\n      sellerFinancingPercent\n    }, \"Risk Score = Base(5) + DSCR Bonus + Cash-on-Cash Bonus + Seller Financing Bonus\", result, {\n      baseScore: 5,\n      dscrContribution: dscr >= 1.5 ? 2 : dscr >= 1.25 ? 1 : -2,\n      cashOnCashContribution: cashOnCash >= 20 ? 2 : cashOnCash >= 15 ? 1 : cashOnCash < 10 ? -1 : 0,\n      sellerFinancingContribution: sellerFinancingPercent >= 20 ? 1 : 0,\n      interpretation: result <= 3 ? \"High Risk\" : result <= 6 ? \"Medium Risk\" : \"Low Risk\"\n    });\n  }\n  return result;\n};\n\n// Calculate financing structure\nexport const calculateFinancingStructure = params => {\n  const {\n    purchasePrice,\n    sellerFinancingPercent,\n    sbaDownPaymentPercent\n  } = params;\n  const sellerFinancing = purchasePrice * (sellerFinancingPercent / 100);\n  const sbaLoanAmount = purchasePrice - sellerFinancing;\n  const downPayment = sbaLoanAmount * (sbaDownPaymentPercent / 100);\n  return {\n    purchasePrice,\n    sellerFinancing,\n    sbaLoanAmount,\n    downPayment\n  };\n};\n\n// Calculate 6-year projections for advanced metrics\nexport const calculateFiveYearProjections = params => {\n  const {\n    targetRevenue,\n    revenueGrowthRatePercent,\n    netProfitMarginPercent,\n    sbaLoanAmount,\n    sellerFinancingAmount,\n    managementSalary,\n    techInvestment,\n    sbaInterestRate = 11.5,\n    sellerInterestRate = 8\n  } = params;\n  const projections = [];\n  let currentRevenue = targetRevenue;\n  for (let year = 1; year <= 6; year++) {\n    const ebitda = currentRevenue * (netProfitMarginPercent / 100);\n    const sbaPayment = calculateSBAPayment(sbaLoanAmount, sbaInterestRate / 100, 10);\n    const sellerPayment = calculateSellerPayment(sellerFinancingAmount, sellerInterestRate / 100, 5);\n    const techInvestmentAmortized = year <= 3 ? techInvestment / 3 : 0;\n    const netCashFlow = ebitda - sbaPayment - sellerPayment - managementSalary - techInvestmentAmortized;\n    projections.push({\n      year,\n      revenue: currentRevenue,\n      ebitda,\n      cashFlow: netCashFlow\n    });\n    currentRevenue *= 1 + revenueGrowthRatePercent / 100;\n  }\n  return projections;\n};\n\n// Calculate business targeting metrics\nexport const calculateBusinessTargetingMetrics = (availableCash, targetRevenue) => {\n  return {\n    maxSafePurchasePrice: availableCash * 4,\n    // Assuming 25% total cash requirement\n    minRequiredEBITDA: availableCash * 4 * 0.12 / 1.25,\n    // 12% debt service / 1.25x coverage\n    targetRevenueRange: {\n      min: targetRevenue * 0.8,\n      max: targetRevenue * 1.2\n    },\n    recommendedMultipleRange: {\n      min: 3.5,\n      max: 5.0\n    }\n  };\n};\n\n// Calculate risk score (1-10)\nexport const calculateRiskScore = params => {\n  let riskScore = 5; // Base score\n\n  // Debt service coverage ratio\n  const ebitda = params.targetRevenue * (params.netProfitMarginPercent / 100);\n  const sbaPayment = calculateSBAPayment(params.sbaLoanAmount);\n  const sellerPayment = calculateSellerPayment(params.sellerFinancingAmount);\n  const totalDebtService = sbaPayment + sellerPayment;\n  const debtCoverageRatio = ebitda / totalDebtService;\n  if (debtCoverageRatio < 1.25) riskScore += 3;else if (debtCoverageRatio < 1.5) riskScore += 1;else if (debtCoverageRatio > 2.0) riskScore -= 1;\n\n  // Working capital ratio\n  const workingCapitalRatio = params.workingCapitalPercent / 100 / (params.netProfitMarginPercent / 100);\n  if (workingCapitalRatio > 0.8) riskScore += 2;else if (workingCapitalRatio < 0.3) riskScore -= 1;\n\n  // SBA down payment\n  if (params.sbaDownPaymentPercent < 12) riskScore += 1;else if (params.sbaDownPaymentPercent > 15) riskScore -= 1;\n  return Math.max(1, Math.min(10, riskScore));\n};\n\n// Calculate business-only WACC (excluding personal loans)\nexport const calculateBusinessWACC = (sbaLoan, sellerFinancing, purchasePrice) => {\n  const totalBusinessDebt = sbaLoan.amount + sellerFinancing.amount;\n  const businessEquity = purchasePrice - totalBusinessDebt;\n  const totalBusinessCapital = purchasePrice;\n  if (totalBusinessCapital <= 0) return 0;\n  const debtWeight = totalBusinessDebt / totalBusinessCapital;\n  const equityWeight = businessEquity / totalBusinessCapital;\n\n  // Different tax treatment for different debt types\n  const sbaAfterTaxCost = 0.115 * 0.75; // 25% tax benefit for business-deductible SBA\n  const sellerAfterTaxCost = 0.08 * 0.9; // 10% tax benefit for seller financing (less deductible)\n  const afterTaxDebtCost = totalBusinessDebt > 0 ? (sbaLoan.amount * sbaAfterTaxCost + sellerFinancing.amount * sellerAfterTaxCost) / totalBusinessDebt : 0;\n  const equityCost = 0.15; // Business equity cost\n\n  return debtWeight * afterTaxDebtCost + equityWeight * equityCost;\n};\n\n// Calculate business-level EVA (excluding personal loans)\nexport const calculateBusinessEVA = (businessEBITDA, businessCapitalInvested, businessWACC) => {\n  const taxRate = 0.25;\n  const nopat = businessEBITDA * (1 - taxRate); // Net Operating Profit After Tax\n  const capitalCharge = businessCapitalInvested * businessWACC;\n  return nopat - capitalCharge;\n};\n\n// Calculate business cash flow (company level only)\nexport const calculateBusinessCashFlow = (scenario, loanStructure, businessCapitalInvested) => {\n  const businessDebtService = loanStructure.sbaLoan.annualPayment + loanStructure.sellerFinancing.annualPayment;\n  const businessFreeCashFlow = scenario.ebitda - businessDebtService - scenario.managementSalary - scenario.techInvestmentAnnual;\n  const businessDSCR = businessDebtService > 0 ? scenario.ebitda / businessDebtService : 0;\n  return {\n    businessRevenue: scenario.targetRevenue,\n    businessEBITDA: scenario.ebitda,\n    businessDebtService: businessDebtService,\n    businessFreeCashFlow: businessFreeCashFlow,\n    businessDSCR: businessDSCR,\n    businessROA: businessCapitalInvested > 0 ? businessFreeCashFlow / businessCapitalInvested * 100 : 0\n  };\n};\n\n// Calculate personal cash flow (owner level only)\nexport const calculatePersonalCashFlow = (businessCashFlow, personalLoans, ownershipData, fundingSources) => {\n  const ownerDistribution = businessCashFlow.businessFreeCashFlow * ownershipData.yourOwnership;\n  const personalDebtService = personalLoans.houseEquity.annualPayment + personalLoans.taiwaneseLoan.annualPayment;\n  const personalNetCashFlow = ownerDistribution - personalDebtService;\n  const personalCashInvested = (fundingSources.personalCash.enabled ? fundingSources.personalCash.amount : 0) + (fundingSources.houseEquity.enabled ? fundingSources.houseEquity.amount : 0) + (fundingSources.taiwaneseLoan.enabled ? fundingSources.taiwaneseLoan.amount : 0);\n  const personalROI = personalCashInvested > 0 ? personalNetCashFlow / personalCashInvested * 100 : 0;\n  return {\n    ownerDistribution: ownerDistribution,\n    personalDebtService: personalDebtService,\n    personalNetCashFlow: personalNetCashFlow,\n    personalCashInvested: personalCashInvested,\n    personalROI: personalROI\n  };\n};\n\n// Calculate personal projections\nexport const calculatePersonalProjections = (businessProjections, personalLoans, ownershipData) => {\n  return businessProjections.map((year, index) => {\n    const businessFCF = year.businessFreeCashFlow;\n    const ownerDistribution = businessFCF * ownershipData.yourOwnership;\n    const personalDebtService = personalLoans.total;\n    const yourFCF = ownerDistribution - personalDebtService;\n    return {\n      year: index + 1,\n      businessFCF: businessFCF,\n      ownerDistribution: ownerDistribution,\n      yourFCF: yourFCF,\n      DSCR: year.businessDSCR,\n      cumulative: index === 0 ? yourFCF : (index > 0 ? businessProjections[index - 1].cumulative : 0) + yourFCF\n    };\n  });\n};\n\n// Calculate risk-adjusted ownership with fair methodology\nexport const calculateRiskAdjustedOwnership = (fundingSources, managementValue = 150000) => {\n  // Calculate risk-weighted contributions\n  const personalCashRisk = fundingSources.personalCash.enabled ? fundingSources.personalCash.amount : 0;\n\n  // Taiwanese loan: Personal guarantee = 80% risk weight\n  const taiwaneseLoanRisk = fundingSources.taiwaneseLoan.enabled ? fundingSources.taiwaneseLoan.amount * 0.8 : 0;\n\n  // Home equity: Personal asset at risk = 120% risk weight (higher risk premium)\n  const homeEquityRisk = fundingSources.houseEquity.enabled ? fundingSources.houseEquity.amount * 1.2 : 0;\n\n  // SBA loan: Personal guarantee but asset-backed = 30% risk weight\n  // const sbaRisk = 0; // SBA loan is debt, not equity contribution\n\n  // Management/operational value (sweat equity)\n  const sweatEquityValue = managementValue;\n\n  // Total personal risk-adjusted contribution\n  const personalRiskAdjusted = personalCashRisk + taiwaneseLoanRisk + homeEquityRisk + sweatEquityValue;\n\n  // Outside investor contribution (100% risk weight)\n  const investorContribution = fundingSources.additionalInvestment.enabled ? fundingSources.additionalInvestment.amount : 0;\n\n  // Total risk-adjusted equity\n  const totalRiskAdjustedEquity = personalRiskAdjusted + investorContribution;\n\n  // Base ownership calculation\n  const baseOwnership = totalRiskAdjustedEquity > 0 ? personalRiskAdjusted / totalRiskAdjustedEquity : 1;\n\n  // Dynamic control premium based on investor amount\n  const controlPremium = investorContribution > 0 ? Math.min(0.05, investorContribution / 1000000) : 0; // Max 5%, scales with investment size\n\n  // Final ownership (capped at 95% to be fair to investors)\n  const finalOwnership = Math.min(0.95, baseOwnership + controlPremium);\n  return {\n    yourOwnership: finalOwnership,\n    investorOwnership: 1 - finalOwnership,\n    breakdown: {\n      personalCashRisk,\n      taiwaneseLoanRisk,\n      homeEquityRisk,\n      sweatEquityValue,\n      investorContribution,\n      controlPremium: controlPremium * 100\n    }\n  };\n};\n\n// Calculate ownership cash flows with preferred return structure\nexport const calculateOwnershipCashFlows = (totalBusinessCashFlow, ownershipData, fundingSources) => {\n  const investorAmount = fundingSources.additionalInvestment.enabled ? fundingSources.additionalInvestment.amount : 0;\n  const personalCashAmount = fundingSources.personalCash.enabled ? fundingSources.personalCash.amount : 0;\n\n  // Investor preferred return (8% on their investment)\n  const investorPreferredReturn = investorAmount * 0.08;\n\n  // Your preferred return (6% on personal cash)\n  const yourPreferredReturn = personalCashAmount * 0.06;\n\n  // Total preferred returns\n  const totalPreferredReturns = investorPreferredReturn + yourPreferredReturn;\n\n  // Remaining cash flow after preferred returns\n  const remainingCashFlow = Math.max(0, totalBusinessCashFlow - totalPreferredReturns);\n\n  // Split remaining cash flow based on ownership percentages\n  const yourRemainingShare = remainingCashFlow * ownershipData.yourOwnership;\n  const investorRemainingShare = remainingCashFlow * ownershipData.investorOwnership;\n\n  // Total distributions\n  const yourTotalCashFlow = yourPreferredReturn + yourRemainingShare;\n  const investorTotalCashFlow = investorPreferredReturn + investorRemainingShare;\n\n  // Calculate ROI on actual cash invested (not risk-adjusted amounts)\n  const yourCashInvested = personalCashAmount;\n  const yourROI = yourCashInvested > 0 ? yourTotalCashFlow / yourCashInvested * 100 : 0;\n  const investorROI = investorAmount > 0 ? investorTotalCashFlow / investorAmount * 100 : 0;\n  return {\n    yourTotalCashFlow,\n    investorTotalCashFlow,\n    yourROI,\n    investorROI,\n    preferredReturns: {\n      yours: yourPreferredReturn,\n      investor: investorPreferredReturn\n    },\n    remainingCashFlowSplit: {\n      yours: yourRemainingShare,\n      investor: investorRemainingShare\n    }\n  };\n};\n\n// Validate ownership for reasonableness\nexport const validateOwnership = (ownershipData, fundingSources, businessMetrics) => {\n  const warnings = [];\n\n  // Check if investor is getting fair deal\n  if (ownershipData.investorOwnership < 0.05 && fundingSources.additionalInvestment.amount > 50000) {\n    warnings.push(\"⚠️ Investor ownership very low - may not be attractive\");\n  }\n\n  // Check if you're giving up too much\n  if (ownershipData.yourOwnership < 0.6 && fundingSources.personalCash.amount > fundingSources.additionalInvestment.amount) {\n    warnings.push(\"⚠️ Your ownership low despite majority funding\");\n  }\n\n  // Check for reasonable investor return (simplified calculation)\n  const investorAmount = fundingSources.additionalInvestment.enabled ? fundingSources.additionalInvestment.amount : 0;\n  const expectedInvestorReturn = investorAmount > 0 ? businessMetrics.totalCashFlow * ownershipData.investorOwnership / investorAmount * 100 : 0;\n  if (expectedInvestorReturn < 15 && investorAmount > 0) {\n    warnings.push(\"⚠️ Investor expected return below market (15%+)\");\n  }\n  return warnings;\n};\n\n// Verification function to test calculations with known values\nexport const verifyCalculations = testScenario => {\n  const {\n    targetRevenue = 2500000,\n    netProfitMargin = 25,\n    valuationMultiple = 4,\n    sbaLoanAmount = 1500000,\n    sellerFinancingAmount = 500000,\n    personalCash = 550000,\n    additionalInvestment = 100000\n  } = testScenario;\n\n  // Test business calculations\n  const ebitda = targetRevenue * (netProfitMargin / 100);\n  const purchasePrice = ebitda * valuationMultiple;\n  const businessCapitalInvested = purchasePrice + targetRevenue * 0.1 + purchasePrice * 0.015 + purchasePrice * 0.008;\n\n  // Test WACC\n  const businessWACC = calculateBusinessWACC({\n    amount: sbaLoanAmount,\n    rate: 0.115\n  }, {\n    amount: sellerFinancingAmount,\n    rate: 0.08\n  }, purchasePrice);\n\n  // Test EVA\n  const businessEVA = calculateBusinessEVA(ebitda, businessCapitalInvested, businessWACC);\n\n  // Test ownership\n  const fundingSources = {\n    personalCash: {\n      enabled: true,\n      amount: personalCash\n    },\n    taiwaneseLoan: {\n      enabled: true,\n      amount: 725000\n    },\n    houseEquity: {\n      enabled: false,\n      amount: 200000\n    },\n    additionalInvestment: {\n      enabled: true,\n      amount: additionalInvestment\n    }\n  };\n  const ownershipData = calculateRiskAdjustedOwnership(fundingSources);\n  return {\n    testScenario: {\n      targetRevenue,\n      ebitda,\n      purchasePrice,\n      businessCapitalInvested,\n      businessWACC: businessWACC * 100,\n      businessEVA,\n      ownershipData\n    },\n    expectedRanges: {\n      businessWACC: {\n        min: 7,\n        max: 12\n      },\n      businessEVA: {\n        min: 0,\n        max: 200000\n      },\n      ownership: {\n        min: 0.6,\n        max: 0.95\n      }\n    }\n  };\n};\n\n// Format currency\nexport const formatCurrency = amount => {\n  return new Intl.NumberFormat('en-US', {\n    style: 'currency',\n    currency: 'USD',\n    minimumFractionDigits: 0,\n    maximumFractionDigits: 0\n  }).format(amount);\n};\n\n// Format percentage\nexport const formatPercentage = value => {\n  return `${value.toFixed(1)}%`;\n};\n\n// FUNDING PRIORITY ALLOCATION FUNCTIONS\n// Calculate total cash needed for acquisition\nexport const calculateTotalCashNeeded = (scenario, variables) => {\n  const purchasePrice = scenario.purchasePrice;\n  const workingCapitalPercent = variables.workingCapital || 14.6;\n  const workingCapital = scenario.targetRevenue * (workingCapitalPercent / 100);\n  const dueDiligence = purchasePrice * 0.015;\n  const professionalFees = purchasePrice * 0.008;\n  const contingency = purchasePrice * 0.025;\n  const techInvestment = variables.techInvestment || 100000;\n\n  // Calculate SBA down payment correctly\n  const sellerFinancingPercent = variables.sellerFinancing || 20;\n  const sellerFinancingAmount = purchasePrice * (sellerFinancingPercent / 100);\n  const sbaLoanAmount = purchasePrice - sellerFinancingAmount;\n  const sbaDownPaymentPercent = variables.sbaDownPayment || 12;\n  const sbaDownPayment = sbaLoanAmount * (sbaDownPaymentPercent / 100);\n  const totalCashNeeded = sbaDownPayment + workingCapital + dueDiligence + professionalFees + contingency + techInvestment;\n  return {\n    purchasePrice,\n    workingCapital,\n    dueDiligence,\n    professionalFees,\n    contingency,\n    techInvestment,\n    sbaDownPayment,\n    totalCashNeeded\n  };\n};\n\n// Allocate funding by priority order (lowest to highest cost) - FOCUSED ON DOWN PAYMENT\nexport const allocateFundingByPriority = (downPaymentNeeded, fundingSources) => {\n  const allocation = {\n    taiwaneseLoan: 0,\n    personalCash: 0,\n    additionalInvestment: 0,\n    sellerFinancing: 0,\n    houseEquity: 0,\n    sbaLoan: 0\n  };\n  let remainingDownPayment = downPaymentNeeded;\n\n  // Priority 1: Taiwanese Loan (cheapest - 2.8%) - $300,000 available\n  if (fundingSources.taiwaneseLoan.enabled && remainingDownPayment > 0) {\n    const used = Math.min(remainingDownPayment, fundingSources.taiwaneseLoan.amount);\n    allocation.taiwaneseLoan = used;\n    remainingDownPayment -= used;\n  }\n\n  // Priority 2: Personal Cash (8% opportunity cost) - $50,000 available\n  if (fundingSources.personalCash.enabled && remainingDownPayment > 0) {\n    const used = Math.min(remainingDownPayment, fundingSources.personalCash.amount);\n    allocation.personalCash = used;\n    remainingDownPayment -= used;\n  }\n\n  // Priority 3: Additional Investment (15% expected return) - $50,000 available\n  if (fundingSources.additionalInvestment.enabled && remainingDownPayment > 0) {\n    const used = Math.min(remainingDownPayment, fundingSources.additionalInvestment.amount);\n    allocation.additionalInvestment = used;\n    remainingDownPayment -= used;\n  }\n\n  // Priority 4: Seller Financing (8%) - $0 available (disabled)\n  if (fundingSources.sellerFinancing.enabled && remainingDownPayment > 0) {\n    const used = Math.min(remainingDownPayment, fundingSources.sellerFinancing.amount);\n    allocation.sellerFinancing = used;\n    remainingDownPayment -= used;\n  }\n\n  // Priority 5: Home Equity Loan (8% but personal asset at risk) - $98,273 available\n  if (fundingSources.houseEquity.enabled && remainingDownPayment > 0) {\n    const used = Math.min(remainingDownPayment, fundingSources.houseEquity.amount);\n    allocation.houseEquity = used;\n    remainingDownPayment -= used;\n  }\n\n  // Priority 6: SBA Loan (11.5% - highest cost, use as last resort) - $0 available (disabled)\n  if (remainingDownPayment > 0) {\n    allocation.sbaLoan = remainingDownPayment; // Whatever is left\n  }\n  return {\n    allocation,\n    downPaymentGap: remainingDownPayment < 0 ? 0 : remainingDownPayment,\n    totalAllocated: downPaymentNeeded - Math.max(0, remainingDownPayment),\n    downPaymentNeeded: downPaymentNeeded,\n    remainingDownPayment: Math.max(0, remainingDownPayment)\n  };\n};\n\n// Determine purchase price financing structure\nexport const calculatePurchasePriceFinancing = (purchasePrice, fundingAllocation, variables) => {\n  // Seller financing reduces the amount that needs bank financing\n  const sellerFinancingAmount = fundingAllocation.allocation.sellerFinancing || 0;\n  const amountNeedingBankFinancing = purchasePrice - sellerFinancingAmount;\n\n  // SBA loan covers remaining purchase price\n  const sbaLoanAmount = Math.max(0, amountNeedingBankFinancing);\n  const sbaDownPaymentPercent = Math.max(variables.sbaDownPayment || 10, 10);\n  const sbaDownPayment = sbaLoanAmount * (sbaDownPaymentPercent / 100);\n  const sbaLoanPrincipal = sbaLoanAmount - sbaDownPayment;\n  return {\n    sellerFinancingAmount,\n    sbaLoanAmount,\n    sbaDownPayment,\n    sbaLoanPrincipal,\n    totalDownPaymentCovered: sbaDownPayment // This comes from cash allocation\n  };\n};\n\n// Calculate business debt service with priority allocation\nexport const calculateBusinessDebtService = purchaseFinancing => {\n  // Only SBA loan and seller financing create debt service for the business\n  const sbaAnnualPayment = calculateSBAPayment(purchaseFinancing.sbaLoanPrincipal, 0.115, 10);\n  const sellerAnnualPayment = calculateSellerPayment(purchaseFinancing.sellerFinancingAmount, 0.08, 5);\n  return {\n    sbaAnnualPayment,\n    sellerAnnualPayment,\n    totalBusinessDebtService: sbaAnnualPayment + sellerAnnualPayment\n  };\n};\n\n// Calculate personal debt service with priority allocation\nexport const calculatePersonalDebtService = fundingAllocation => {\n  // Only personal loans create personal debt service\n  const houseEquityPayment = fundingAllocation.allocation.houseEquity > 0 ? calculateSBAPayment(fundingAllocation.allocation.houseEquity, 0.08, 15) : 0;\n  const taiwanesePayment = fundingAllocation.allocation.taiwaneseLoan > 0 ? calculateSBAPayment(fundingAllocation.allocation.taiwaneseLoan, 0.028, 10) : 0;\n  return {\n    houseEquityPayment,\n    taiwanesePayment,\n    totalPersonalDebtService: houseEquityPayment + taiwanesePayment\n  };\n};\n\n// Calculate WACC with priority-based allocation - ALL FUNDING SOURCES\nexport const calculatePriorityBasedWACC = (fundingAllocation, purchasePrice) => {\n  // WACC should include ALL funding sources used for the business acquisition\n  // Each source has its own after-tax cost of capital\n\n  let totalFunding = 0;\n  let weightedCost = 0;\n\n  // After-tax cost rates for each funding source\n  const afterTaxCostRates = {\n    taiwaneseLoan: 0.028 * 0.75,\n    // 2.8% × 0.75 = 2.1% after-tax (if business deductible)\n    personalCash: 0.08 * 0.75,\n    // 8% × 0.75 = 6% after-tax (opportunity cost with tax benefit)\n    additionalInvestment: 0.15,\n    // 15% equity cost (no tax benefit)\n    sellerFinancing: 0.08 * 0.75,\n    // 8% × 0.75 = 6% after-tax\n    houseEquity: 0.08,\n    // 8% (personal debt, no business tax benefit)\n    sbaLoan: 0.115 * 0.75 // 11.5% × 0.75 = 8.6% after-tax\n  };\n\n  // Calculate weighted average cost of capital across all funding sources\n  Object.entries(fundingAllocation.allocation).forEach(([source, amount]) => {\n    if (amount > 0) {\n      totalFunding += amount;\n      weightedCost += amount * afterTaxCostRates[source];\n    }\n  });\n  return totalFunding > 0 ? weightedCost / totalFunding * 100 : 0;\n};\n\n// Calculate ownership with priority-based allocation\nexport const calculatePriorityBasedOwnership = fundingAllocation => {\n  // Risk-adjusted personal contributions based on ACTUAL allocated amounts\n  const personalCashRisk = fundingAllocation.allocation.personalCash * 1.0;\n  const taiwaneseLoanRisk = fundingAllocation.allocation.taiwaneseLoan * 0.8; // Personal guarantee\n  const houseEquityRisk = fundingAllocation.allocation.houseEquity * 1.2; // Personal asset risk\n\n  const totalPersonalRisk = personalCashRisk + taiwaneseLoanRisk + houseEquityRisk;\n  const investorContribution = fundingAllocation.allocation.additionalInvestment;\n  const totalEquity = totalPersonalRisk + investorContribution;\n  const finalOwnership = totalEquity > 0 ? totalPersonalRisk / totalEquity : 1; // Removed control premium\n\n  return {\n    yourOwnership: finalOwnership,\n    investorOwnership: 1 - finalOwnership,\n    breakdown: {\n      personalCashRisk,\n      taiwaneseLoanRisk,\n      houseEquityRisk,\n      investorContribution\n    }\n  };\n};\n\n// Calculate personal cost of capital (for personal funding sources)\nexport const calculatePersonalCostOfCapital = fundingAllocation => {\n  let totalPersonalFunding = 0;\n  let weightedPersonalCost = 0;\n\n  // Only consider personal funding sources: Taiwanese Loan, Personal Cash, Home Equity\n  const personalCostRates = {\n    taiwaneseLoan: 0.028,\n    // 2.8% - personal loan rate\n    personalCash: 0.08,\n    // 8% opportunity cost\n    houseEquity: 0.08 // 8% home equity rate\n    // Excluded: additionalInvestment, sellerFinancing, sbaLoan (not personal funding)\n  };\n\n  // Only calculate for personal funding sources\n  const personalSources = ['taiwaneseLoan', 'personalCash', 'houseEquity'];\n  personalSources.forEach(source => {\n    const amount = fundingAllocation.allocation[source] || 0;\n    if (amount > 0) {\n      totalPersonalFunding += amount;\n      weightedPersonalCost += amount * personalCostRates[source];\n    }\n  });\n  return totalPersonalFunding > 0 ? weightedPersonalCost / totalPersonalFunding * 100 : 0;\n};\n\n// Main scenario calculation with priority-based funding\nexport const calculateScenariosWithPriority = (targetRevenues, variables, fundingSources) => {\n  return targetRevenues.map(revenue => {\n    // Step 1: Calculate business metrics\n    const netMargin = variables.netProfitMargin || 25;\n    const valuationMultiple = variables.valuationMultiple || 4;\n    const ebitda = revenue * (netMargin / 100);\n    const purchasePrice = ebitda * valuationMultiple;\n\n    // Log Purchase Price calculation\n    if (DEBUG_METRICS) {\n      logMetricCalculation(\"Deal Structure\", \"Purchase Price\", {\n        targetRevenue: revenue,\n        netProfitMargin: netMargin,\n        valuationMultiple: valuationMultiple\n      }, \"Purchase Price = Target Revenue × Net Profit Margin × Valuation Multiple\", purchasePrice, {\n        netProfitMarginSource: \"User input assumption\",\n        valuationMultipleSource: \"Market multiple assumption\",\n        calculation: `${revenue} × ${netMargin}% × ${valuationMultiple}x = ${purchasePrice}`\n      });\n    }\n    const businessMetrics = {\n      targetRevenue: revenue,\n      ebitda: ebitda,\n      purchasePrice: purchasePrice\n    };\n\n    // Step 2: Calculate down payment needed (same logic as Scenario Comparison)\n    const downPaymentCalculation = calculateDownPaymentNeeded(businessMetrics, variables);\n\n    // Log Down Payment calculation\n    if (DEBUG_METRICS) {\n      logMetricCalculation(\"Deal Structure\", \"Down Payment Needed\", {\n        sbaDownPayment: downPaymentCalculation.sbaDownPayment,\n        workingCapital: downPaymentCalculation.workingCapital,\n        fees: downPaymentCalculation.fees\n      }, \"Down Payment = SBA Down Payment + Working Capital + Due Diligence + Professional Fees\", downPaymentCalculation.downPaymentNeeded, {\n        workingCapitalPercent: variables.workingCapital || 7.9,\n        dueDiligencePercent: 1.5,\n        professionalFeesPercent: 1.0,\n        calculation: `${downPaymentCalculation.sbaDownPayment} + ${downPaymentCalculation.workingCapital} + ${downPaymentCalculation.fees} = ${downPaymentCalculation.downPaymentNeeded}`\n      });\n    }\n\n    // Step 3: Allocate funding by priority based on down payment needed\n    const fundingAllocation = allocateFundingByPriority(downPaymentCalculation.downPaymentNeeded, fundingSources);\n\n    // Step 4: Calculate purchase price financing\n    const purchaseFinancing = calculatePurchasePriceFinancing(businessMetrics.purchasePrice, fundingAllocation, variables);\n\n    // Step 5: Calculate debt service\n    const businessDebtService = calculateBusinessDebtService(purchaseFinancing);\n    const personalDebtService = calculatePersonalDebtService(fundingAllocation);\n\n    // Step 6: Calculate ownership, WACC, and personal cost of capital\n    const ownership = calculatePriorityBasedOwnership(fundingAllocation);\n    const wacc = calculatePriorityBasedWACC(fundingAllocation, businessMetrics.purchasePrice);\n    const personalCostOfCapital = calculatePersonalCostOfCapital(fundingAllocation);\n\n    // Log WACC calculation\n    if (DEBUG_METRICS) {\n      logMetricCalculation(\"Deal Structure\", \"WACC\", {\n        fundingAllocation: fundingAllocation.allocation,\n        purchasePrice: businessMetrics.purchasePrice\n      }, \"WACC = Σ(Weight × After-tax Rate) for all funding sources\", wacc, {\n        taxRate: 0.25,\n        afterTaxRates: \"Calculated based on funding source rates\",\n        calculation: `Weighted average of all funding source rates`\n      });\n    }\n\n    // Log Personal Cost calculation\n    if (DEBUG_METRICS) {\n      logMetricCalculation(\"Deal Structure\", \"Your Personal Cost\", {\n        personalFunding: {\n          taiwaneseLoan: fundingAllocation.allocation.taiwaneseLoan,\n          personalCash: fundingAllocation.allocation.personalCash,\n          houseEquity: fundingAllocation.allocation.houseEquity\n        },\n        personalCostOfCapital\n      }, \"Personal Cost = Weighted average of personal funding sources\", personalCostOfCapital, {\n        personalSources: \"Taiwanese Loan + Personal Cash + Home Equity\",\n        calculation: `Weighted average of personal funding rates`\n      });\n    }\n\n    // Step 7: Calculate cash flows\n    const businessCashFlow = businessMetrics.ebitda - businessDebtService.totalBusinessDebtService - (variables.managementSalary || 100000) - (variables.techInvestment || 100000) / 3;\n    const ownerDistribution = businessCashFlow * ownership.yourOwnership;\n    const personalNetCashFlow = ownerDistribution - personalDebtService.totalPersonalDebtService;\n\n    // Log Business Cash Flow calculation\n    if (DEBUG_METRICS) {\n      logMetricCalculation(\"Business Health\", \"Business Free Cash Flow\", {\n        ebitda: businessMetrics.ebitda,\n        businessDebtService: businessDebtService.totalBusinessDebtService,\n        managementSalary: variables.managementSalary || 100000,\n        techInvestment: (variables.techInvestment || 100000) / 3\n      }, \"Business FCF = EBITDA - Business Debt Service - Management Salary - Tech Investment/3\", businessCashFlow, {\n        techInvestmentAmortization: \"Amortized over 3 years\",\n        calculation: `${businessMetrics.ebitda} - ${businessDebtService.totalBusinessDebtService} - ${variables.managementSalary || 100000} - ${(variables.techInvestment || 100000) / 3} = ${businessCashFlow}`\n      });\n    }\n\n    // Log Personal Cash Flow calculation\n    if (DEBUG_METRICS) {\n      logMetricCalculation(\"Personal Returns\", \"Your Net Annual Gain\", {\n        ownerDistribution,\n        personalDebtService: personalDebtService.totalPersonalDebtService,\n        yourOwnership: ownership.yourOwnership\n      }, \"Your Net Annual Gain = Owner Distribution - Personal Debt Service\", personalNetCashFlow, {\n        ownerDistributionCalculation: `Business FCF × Your Ownership %`,\n        calculation: `${ownerDistribution} - ${personalDebtService.totalPersonalDebtService} = ${personalNetCashFlow}`\n      });\n    }\n\n    // Log ROI calculation\n    if (DEBUG_METRICS) {\n      const yourTotalCashInvested = fundingAllocation.allocation.personalCash + fundingAllocation.allocation.taiwaneseLoan + fundingAllocation.allocation.houseEquity;\n      const yourROI = personalNetCashFlow / yourTotalCashInvested * 100;\n      logMetricCalculation(\"Personal Returns\", \"Your ROI\", {\n        yourNetAnnualGain: personalNetCashFlow,\n        yourTotalCashInvested\n      }, \"Your ROI = (Your Net Annual Gain ÷ Your Total Cash Invested) × 100\", yourROI, {\n        yourCashInvestedComponents: \"Personal Cash + Taiwanese Loan + Home Equity\",\n        netAnnualGainComponents: \"Business Distribution - Personal Debt Service\",\n        calculation: `(${personalNetCashFlow} ÷ ${yourTotalCashInvested}) × 100 = ${yourROI}%`\n      });\n    }\n    return {\n      ...businessMetrics,\n      ...downPaymentCalculation,\n      fundingAllocation,\n      purchaseFinancing,\n      businessDebtService,\n      personalDebtService,\n      ownership,\n      wacc,\n      personalCostOfCapital,\n      businessCashFlow,\n      ownerDistribution,\n      personalNetCashFlow,\n      personalROI: personalNetCashFlow / (fundingAllocation.allocation.personalCash + fundingAllocation.allocation.taiwaneseLoan + fundingAllocation.allocation.houseEquity) * 100\n    };\n  });\n};\n\n// Calculate down payment needed using the same logic as Scenario Comparison\nexport const calculateDownPaymentNeeded = (scenario, variables) => {\n  const purchasePrice = scenario.purchasePrice;\n\n  // Calculate SBA down payment\n  const sellerFinancingPercent = variables.sellerFinancing || 20;\n  const sellerFinancingAmount = purchasePrice * (sellerFinancingPercent / 100);\n  const sbaLoanAmount = purchasePrice - sellerFinancingAmount;\n  const sbaDownPaymentPercent = variables.sbaDownPayment || 12;\n  const sbaDownPayment = sbaLoanAmount * (sbaDownPaymentPercent / 100);\n\n  // Calculate working capital and fees (same as Scenario Comparison)\n  const workingCapitalPercent = variables.workingCapital || 7.9;\n  const workingCapital = scenario.targetRevenue * (workingCapitalPercent / 100);\n  const fees = purchasePrice * 0.025; // 2.5% total fees (due diligence + professional fees)\n\n  // Down Payment Needed = SBA Down Payment + Working Capital + Fees\n  const downPaymentNeeded = sbaDownPayment + workingCapital + fees;\n  return {\n    sbaDownPayment,\n    workingCapital,\n    fees,\n    downPaymentNeeded\n  };\n};\n\n// NEW METRICS CALCULATIONS\n\n// Capital Utilization Rate\nexport const calculateCapitalUtilizationRate = (totalAllocated, availableCash) => {\n  return availableCash > 0 ? totalAllocated / availableCash * 100 : 0;\n};\nexport const getCapitalUtilizationStatus = rate => {\n  if (rate > 95) return {\n    color: '#E74C3C',\n    level: 'critical',\n    label: 'Critical'\n  };\n  if (rate > 85) return {\n    color: '#F1C40F',\n    level: 'below-target',\n    label: 'Below Target'\n  };\n  if (rate > 65) return {\n    color: '#27AE60',\n    level: 'good',\n    label: 'Good'\n  };\n  return {\n    color: '#3498DB',\n    level: 'excellent',\n    label: 'Excellent'\n  };\n};\n\n// Leverage Multiplier\nexport const calculateLeverageMultiplier = (totalInvestment, personalCashInvested) => {\n  const result = personalCashInvested > 0 ? totalInvestment / personalCashInvested : 0;\n  if (DEBUG_METRICS) {\n    logMetricCalculation(\"Deal Structure\", \"Leverage Multiplier\", {\n      totalInvestment,\n      personalCashInvested\n    }, \"Leverage Multiplier = Total Investment ÷ Personal Cash Invested\", result, {\n      interpretation: result >= 8 ? \"Excellent leverage\" : result >= 5 ? \"Good leverage\" : result >= 3 ? \"Fair leverage\" : \"Poor leverage\",\n      calculation: `${totalInvestment} ÷ ${personalCashInvested} = ${result}x`\n    });\n  }\n  return result;\n};\nexport const getLeverageMultiplierStatus = multiplier => {\n  if (multiplier < 3) return {\n    color: '#E74C3C',\n    level: 'critical',\n    label: 'Critical'\n  };\n  if (multiplier < 5) return {\n    color: '#F1C40F',\n    level: 'below-target',\n    label: 'Below Target'\n  };\n  if (multiplier < 8) return {\n    color: '#27AE60',\n    level: 'good',\n    label: 'Good'\n  };\n  return {\n    color: '#3498DB',\n    level: 'excellent',\n    label: 'Excellent'\n  };\n};\n\n// Price-to-Revenue Ratio\nexport const calculatePriceToRevenueRatio = (purchasePrice, targetRevenue) => {\n  return targetRevenue > 0 ? purchasePrice / targetRevenue : 0;\n};\nexport const getPriceToRevenueStatus = ratio => {\n  if (ratio > 1.2) return {\n    color: '#E74C3C',\n    level: 'critical',\n    label: 'Critical'\n  };\n  if (ratio > 1.0) return {\n    color: '#F1C40F',\n    level: 'below-target',\n    label: 'Below Target'\n  };\n  if (ratio > 0.8) return {\n    color: '#27AE60',\n    level: 'good',\n    label: 'Good'\n  };\n  return {\n    color: '#3498DB',\n    level: 'excellent',\n    label: 'Excellent'\n  };\n};\n\n// EBITDA Margin\nexport const calculateEBITDAMargin = (ebitda, revenue) => {\n  return revenue > 0 ? ebitda / revenue * 100 : 0;\n};\nexport const getEBITDAMarginStatus = margin => {\n  if (margin < 15) return {\n    color: '#E74C3C',\n    level: 'critical',\n    label: 'Critical'\n  };\n  if (margin < 18) return {\n    color: '#F1C40F',\n    level: 'below-target',\n    label: 'Below Target'\n  };\n  if (margin < 22) return {\n    color: '#27AE60',\n    level: 'good',\n    label: 'Good'\n  };\n  return {\n    color: '#3498DB',\n    level: 'excellent',\n    label: 'Excellent'\n  };\n};\n\n// Business Cash Conversion\nexport const calculateBusinessCashConversion = (businessFreeCashFlow, businessEBITDA) => {\n  return businessEBITDA > 0 ? businessFreeCashFlow / businessEBITDA * 100 : 0;\n};\nexport const getCashConversionStatus = conversion => {\n  if (conversion < 15) return {\n    color: '#E74C3C',\n    level: 'critical',\n    label: 'Critical'\n  };\n  if (conversion < 20) return {\n    color: '#F1C40F',\n    level: 'below-target',\n    label: 'Below Target'\n  };\n  if (conversion < 30) return {\n    color: '#27AE60',\n    level: 'good',\n    label: 'Good'\n  };\n  return {\n    color: '#3498DB',\n    level: 'excellent',\n    label: 'Excellent'\n  };\n};\n\n// Revenue-to-Investment Efficiency\nexport const calculateRevenueToInvestmentEfficiency = (targetRevenue, yourTotalInvestment) => {\n  return yourTotalInvestment > 0 ? targetRevenue / yourTotalInvestment : 0;\n};\nexport const getRevenueEfficiencyStatus = efficiency => {\n  if (efficiency < 3) return {\n    color: '#E74C3C',\n    level: 'critical',\n    label: 'Critical'\n  };\n  if (efficiency < 4) return {\n    color: '#F1C40F',\n    level: 'below-target',\n    label: 'Below Target'\n  };\n  if (efficiency < 6) return {\n    color: '#27AE60',\n    level: 'good',\n    label: 'Good'\n  };\n  return {\n    color: '#3498DB',\n    level: 'excellent',\n    label: 'Excellent'\n  };\n};\n\n// Risk-Adjusted Return\nexport const calculateRiskAdjustedReturn = (yourROI, riskFreeRate = 4.5, riskScore) => {\n  const result = riskScore > 0 ? (yourROI - riskFreeRate) / riskScore : 0;\n  if (DEBUG_METRICS) {\n    logMetricCalculation(\"Personal Returns\", \"Risk-Adjusted Return\", {\n      yourROI,\n      riskFreeRate,\n      riskScore\n    }, \"Risk-Adjusted Return = (Your ROI - Risk-Free Rate) ÷ Risk Score\", result, {\n      interpretation: result >= 1.5 ? \"Excellent risk-adjusted return\" : result >= 1.0 ? \"Good risk-adjusted return\" : result >= 0.5 ? \"Fair risk-adjusted return\" : \"Poor risk-adjusted return\",\n      calculation: `(${yourROI} - ${riskFreeRate}) ÷ ${riskScore} = ${result}`\n    });\n  }\n  return result;\n};\nexport const getRiskAdjustedStatus = ratio => {\n  if (ratio < 0.5) return {\n    color: '#E74C3C',\n    level: 'critical',\n    label: 'Critical'\n  };\n  if (ratio < 1.0) return {\n    color: '#F1C40F',\n    level: 'below-target',\n    label: 'Below Target'\n  };\n  if (ratio < 1.5) return {\n    color: '#27AE60',\n    level: 'good',\n    label: 'Good'\n  };\n  return {\n    color: '#3498DB',\n    level: 'excellent',\n    label: 'Excellent'\n  };\n};\n\n// Income Replacement Ratio\nexport const calculateIncomeReplacementRatio = (yourNetAnnualGain, currentSalary) => {\n  const result = currentSalary > 0 ? yourNetAnnualGain / currentSalary * 100 : 0;\n  if (DEBUG_METRICS) {\n    logMetricCalculation(\"Personal Returns\", \"W-2 Replacement\", {\n      yourNetAnnualGain,\n      currentSalary\n    }, \"W-2 Replacement = (Your Net Annual Gain ÷ Current Salary) × 100\", result, {\n      interpretation: result >= 120 ? \"Excellent replacement\" : result >= 80 ? \"Good replacement\" : result >= 40 ? \"Fair replacement\" : \"Poor replacement\",\n      calculation: `(${yourNetAnnualGain} ÷ ${currentSalary}) × 100 = ${result}%`\n    });\n  }\n  return result;\n};\nexport const getIncomeReplacementStatus = ratio => {\n  if (ratio < 40) return {\n    color: '#E74C3C',\n    level: 'critical',\n    label: 'Critical'\n  };\n  if (ratio < 80) return {\n    color: '#F1C40F',\n    level: 'below-target',\n    label: 'Below Target'\n  };\n  if (ratio < 120) return {\n    color: '#27AE60',\n    level: 'good',\n    label: 'Good'\n  };\n  return {\n    color: '#3498DB',\n    level: 'excellent',\n    label: 'Excellent'\n  };\n};\n\n// Wealth Building Velocity\nexport const calculateWealthBuildingVelocity = (totalReturnMultiple, investmentPeriod = 5) => {\n  const annualWealthCreation = Math.pow(totalReturnMultiple, 1 / investmentPeriod) - 1;\n  const result = annualWealthCreation * 100;\n  if (DEBUG_METRICS) {\n    logMetricCalculation(\"Personal Returns\", \"Wealth Velocity\", {\n      totalReturnMultiple,\n      investmentPeriod\n    }, \"Wealth Velocity = Annual wealth creation rate from total return multiple\", result, {\n      interpretation: result >= 80 ? \"Excellent velocity\" : result >= 40 ? \"Good velocity\" : result >= 20 ? \"Fair velocity\" : \"Poor velocity\",\n      calculation: `Annual wealth creation from ${totalReturnMultiple}x return over ${investmentPeriod} years = ${result}%`\n    });\n  }\n  return result;\n};\nexport const getWealthVelocityStatus = velocity => {\n  if (velocity < 20) return {\n    color: '#E74C3C',\n    level: 'critical',\n    label: 'Critical'\n  };\n  if (velocity < 40) return {\n    color: '#F1C40F',\n    level: 'below-target',\n    label: 'Below Target'\n  };\n  if (velocity < 80) return {\n    color: '#27AE60',\n    level: 'good',\n    label: 'Good'\n  };\n  return {\n    color: '#3498DB',\n    level: 'excellent',\n    label: 'Excellent'\n  };\n};\n\n// 6-Year Exit Value Range\nexport const calculateExitValueRange = (year6EBITDA, yourOwnership, conservativeMultiple = 3.0, expectedMultiple = 3.59, optimisticMultiple = 4.5) => {\n  return {\n    conservative: year6EBITDA * conservativeMultiple * yourOwnership,\n    expected: year6EBITDA * expectedMultiple * yourOwnership,\n    optimistic: year6EBITDA * optimisticMultiple * yourOwnership\n  };\n};\n\n// Stress Test Results\nexport const calculateStressTestResults = (baseROI, revenueStress = -20, marginStress = -300, rateStress = 200) => {\n  // Simplified stress test calculations\n  const revenueStressROI = baseROI * (1 + revenueStress / 100);\n  const marginStressROI = baseROI * (1 + marginStress / 10000); // basis points\n  const rateStressROI = baseROI * (1 - rateStress / 10000); // basis points\n\n  const minROI = Math.min(revenueStressROI, marginStressROI, rateStressROI);\n  return {\n    revenueStressROI,\n    marginStressROI,\n    rateStressROI,\n    minROI\n  };\n};\nexport const getStressTestStatus = minROI => {\n  if (minROI < 5) return {\n    color: '#E74C3C',\n    level: 'critical',\n    label: 'Critical'\n  };\n  if (minROI < 7) return {\n    color: '#F1C40F',\n    level: 'below-target',\n    label: 'Below Target'\n  };\n  if (minROI < 10) return {\n    color: '#27AE60',\n    level: 'good',\n    label: 'Good'\n  };\n  return {\n    color: '#3498DB',\n    level: 'excellent',\n    label: 'Excellent'\n  };\n};\n\n// Growth Funding Capacity\nexport const calculateGrowthFundingCapacity = (maxSustainableDebt, currentTotalDebt, projectedYear3CashFlow, leverageMultiplier) => {\n  const currentDebtCapacity = maxSustainableDebt - currentTotalDebt;\n  const cashFlowGrowthCapacity = projectedYear3CashFlow * leverageMultiplier;\n  return Math.min(currentDebtCapacity, cashFlowGrowthCapacity);\n};\nexport const getGrowthCapacityStatus = capacity => {\n  if (capacity < 50000) return {\n    color: '#E74C3C',\n    level: 'critical',\n    label: 'Critical'\n  };\n  if (capacity < 100000) return {\n    color: '#F1C40F',\n    level: 'below-target',\n    label: 'Below Target'\n  };\n  if (capacity < 200000) return {\n    color: '#27AE60',\n    level: 'good',\n    label: 'Good'\n  };\n  return {\n    color: '#3498DB',\n    level: 'excellent',\n    label: 'Excellent'\n  };\n};","map":{"version":3,"names":["DEBUG_METRICS","logMetricCalculation","sectionName","metricName","inputs","formula","result","assumptions","console","group","log","groupEnd","logAllMetricsSummary","scenario","metrics","purchasePrice","availableCash","cashSurplus","wacc","businessDSCR","businessROA","debtToEBITDA","interestCoverage","yourROI","cashOnCashReturn","paybackPeriod","targetRevenue","netProfitMargin","valuationMultiple","revenueGrowthRate","workingCapitalPercent","managementSalary","calculateSBAPayment","principal","rate","years","monthlyRate","payments","Math","pow","calculateSellerPayment","calculateExpectedValue","scenarios","probabilities","bestCase","mostLikely","worstCase","normalizeProbabilities","best","likely","worst","total","factor","round","validateSBADownPayment","value","max","validateDebtCoverage","ebitda","debtService","generateBellCurve","mean","min","stdDev","points","x","y","exp","push","calculateTotalCashRequired","params","sbaDownPaymentPercent","techInvestment","sellerFinancingPercent","dueDiligencePercent","professionalFeesPercent","contingencyPercent","sellerFinancingAmount","sbaLoanAmount","sbaDownPayment","workingCapital","dueDiligence","professionalFees","contingency","downPayment","calculateAnnualCashToPocket","netProfitMarginPercent","sbaPayment","sellerPayment","techInvestmentAmortized","netCashFlow","calculateDSCR","annualEBITDA","totalAnnualDebtService","interpretation","calculation","calculateCashOnCashReturn","annualCashToPocket","personalCashInvested","calculateIRR","personalInvestment","cashFlows","tolerance","maxIterations","guess","i","npv","derivative","j","length","discountFactor","newGuess","abs","iterations","method","error","calculateMOIC","fiveYearProjections","totalCashReturned","reduce","sum","year","cashFlow","businessValueAtExit","year5EBITDA","exitMultiple","exitMultipleSource","calculatePaybackPeriod","cumulativeCashFlow","map","p","calculateEnhancedRiskScore","dscr","cashOnCash","score","baseScore","dscrContribution","cashOnCashContribution","sellerFinancingContribution","calculateFinancingStructure","sellerFinancing","calculateFiveYearProjections","revenueGrowthRatePercent","sbaInterestRate","sellerInterestRate","projections","currentRevenue","revenue","calculateBusinessTargetingMetrics","maxSafePurchasePrice","minRequiredEBITDA","targetRevenueRange","recommendedMultipleRange","calculateRiskScore","riskScore","totalDebtService","debtCoverageRatio","workingCapitalRatio","calculateBusinessWACC","sbaLoan","totalBusinessDebt","amount","businessEquity","totalBusinessCapital","debtWeight","equityWeight","sbaAfterTaxCost","sellerAfterTaxCost","afterTaxDebtCost","equityCost","calculateBusinessEVA","businessEBITDA","businessCapitalInvested","businessWACC","taxRate","nopat","capitalCharge","calculateBusinessCashFlow","loanStructure","businessDebtService","annualPayment","businessFreeCashFlow","techInvestmentAnnual","businessRevenue","calculatePersonalCashFlow","businessCashFlow","personalLoans","ownershipData","fundingSources","ownerDistribution","yourOwnership","personalDebtService","houseEquity","taiwaneseLoan","personalNetCashFlow","personalCash","enabled","personalROI","calculatePersonalProjections","businessProjections","index","businessFCF","yourFCF","DSCR","cumulative","calculateRiskAdjustedOwnership","managementValue","personalCashRisk","taiwaneseLoanRisk","homeEquityRisk","sweatEquityValue","personalRiskAdjusted","investorContribution","additionalInvestment","totalRiskAdjustedEquity","baseOwnership","controlPremium","finalOwnership","investorOwnership","breakdown","calculateOwnershipCashFlows","totalBusinessCashFlow","investorAmount","personalCashAmount","investorPreferredReturn","yourPreferredReturn","totalPreferredReturns","remainingCashFlow","yourRemainingShare","investorRemainingShare","yourTotalCashFlow","investorTotalCashFlow","yourCashInvested","investorROI","preferredReturns","yours","investor","remainingCashFlowSplit","validateOwnership","businessMetrics","warnings","expectedInvestorReturn","totalCashFlow","verifyCalculations","testScenario","businessEVA","expectedRanges","ownership","formatCurrency","Intl","NumberFormat","style","currency","minimumFractionDigits","maximumFractionDigits","format","formatPercentage","toFixed","calculateTotalCashNeeded","variables","totalCashNeeded","allocateFundingByPriority","downPaymentNeeded","allocation","remainingDownPayment","used","downPaymentGap","totalAllocated","calculatePurchasePriceFinancing","fundingAllocation","amountNeedingBankFinancing","sbaLoanPrincipal","totalDownPaymentCovered","calculateBusinessDebtService","purchaseFinancing","sbaAnnualPayment","sellerAnnualPayment","totalBusinessDebtService","calculatePersonalDebtService","houseEquityPayment","taiwanesePayment","totalPersonalDebtService","calculatePriorityBasedWACC","totalFunding","weightedCost","afterTaxCostRates","Object","entries","forEach","source","calculatePriorityBasedOwnership","houseEquityRisk","totalPersonalRisk","totalEquity","calculatePersonalCostOfCapital","totalPersonalFunding","weightedPersonalCost","personalCostRates","personalSources","calculateScenariosWithPriority","targetRevenues","netMargin","netProfitMarginSource","valuationMultipleSource","downPaymentCalculation","calculateDownPaymentNeeded","fees","personalCostOfCapital","afterTaxRates","personalFunding","techInvestmentAmortization","ownerDistributionCalculation","yourTotalCashInvested","yourNetAnnualGain","yourCashInvestedComponents","netAnnualGainComponents","calculateCapitalUtilizationRate","getCapitalUtilizationStatus","color","level","label","calculateLeverageMultiplier","totalInvestment","getLeverageMultiplierStatus","multiplier","calculatePriceToRevenueRatio","getPriceToRevenueStatus","ratio","calculateEBITDAMargin","getEBITDAMarginStatus","margin","calculateBusinessCashConversion","getCashConversionStatus","conversion","calculateRevenueToInvestmentEfficiency","yourTotalInvestment","getRevenueEfficiencyStatus","efficiency","calculateRiskAdjustedReturn","riskFreeRate","getRiskAdjustedStatus","calculateIncomeReplacementRatio","currentSalary","getIncomeReplacementStatus","calculateWealthBuildingVelocity","totalReturnMultiple","investmentPeriod","annualWealthCreation","getWealthVelocityStatus","velocity","calculateExitValueRange","year6EBITDA","conservativeMultiple","expectedMultiple","optimisticMultiple","conservative","expected","optimistic","calculateStressTestResults","baseROI","revenueStress","marginStress","rateStress","revenueStressROI","marginStressROI","rateStressROI","minROI","getStressTestStatus","calculateGrowthFundingCapacity","maxSustainableDebt","currentTotalDebt","projectedYear3CashFlow","leverageMultiplier","currentDebtCapacity","cashFlowGrowthCapacity","getGrowthCapacityStatus","capacity"],"sources":["/Users/juihanlin/Desktop/Biz Acquisition Calculator/src/utils/calculations.js"],"sourcesContent":["// Debug logging functions for comprehensive metric tracking\nexport const DEBUG_METRICS = true;\n\nexport function logMetricCalculation(sectionName, metricName, inputs, formula, result, assumptions = {}) {\n  if (!DEBUG_METRICS) return;\n  \n  console.group(`📊 ${sectionName} - ${metricName}`);\n  console.log(`🔢 INPUTS:`, inputs);\n  console.log(`📐 FORMULA: ${formula}`);\n  console.log(`📋 ASSUMPTIONS:`, assumptions);\n  console.log(`✅ RESULT: ${result}`);\n  console.log(`---`);\n  console.groupEnd();\n}\n\nexport function logAllMetricsSummary(scenario, metrics) {\n  if (!DEBUG_METRICS) return;\n  \n  console.group(\"📊 DASHBOARD METRICS SUMMARY\");\n  \n  console.log(\"🏢 DEAL STRUCTURE:\");\n  console.log(`  Purchase Price: ${metrics.purchasePrice}`);\n  console.log(`  Available Cash: ${metrics.availableCash}`);\n  console.log(`  Cash Surplus: ${metrics.cashSurplus}`);\n  console.log(`  WACC: ${metrics.wacc}%`);\n  \n  console.log(\"📈 BUSINESS HEALTH:\");\n  console.log(`  DSCR: ${metrics.businessDSCR}x`);\n  console.log(`  ROA: ${metrics.businessROA}%`);\n  console.log(`  Debt/EBITDA: ${metrics.debtToEBITDA}x`);\n  console.log(`  Interest Coverage: ${metrics.interestCoverage}x`);\n  \n  console.log(\"💰 PERSONAL RETURNS:\");\n  console.log(`  Your ROI: ${metrics.yourROI}%`);\n  console.log(`  Cash-on-Cash: ${metrics.cashOnCashReturn}%`);\n  console.log(`  Payback: ${metrics.paybackPeriod} years`);\n  \n  console.log(\"📊 KEY ASSUMPTIONS:\");\n  console.log(`  Target Revenue: ${scenario.targetRevenue}`);\n  console.log(`  Net Profit Margin: ${scenario.netProfitMargin}%`);\n  console.log(`  Valuation Multiple: ${scenario.valuationMultiple}x`);\n  console.log(`  Revenue Growth: ${scenario.revenueGrowthRate}%`);\n  console.log(`  Working Capital %: ${scenario.workingCapitalPercent}%`);\n  console.log(`  Management Salary: ${scenario.managementSalary}`);\n  \n  console.groupEnd();\n}\n\n// SBA loan payment calculation\nexport const calculateSBAPayment = (principal, rate = 0.115, years = 10) => {\n  const monthlyRate = rate / 12;\n  const payments = years * 12;\n  return (principal * monthlyRate * Math.pow(1 + monthlyRate, payments)) / \n         (Math.pow(1 + monthlyRate, payments) - 1) * 12;\n};\n\n// Seller note payment calculation  \nexport const calculateSellerPayment = (principal, rate = 0.08, years = 5) => {\n  const monthlyRate = rate / 12;\n  const payments = years * 12;\n  return (principal * monthlyRate * Math.pow(1 + monthlyRate, payments)) / \n         (Math.pow(1 + monthlyRate, payments) - 1) * 12;\n};\n\n// Expected value calculation\nexport const calculateExpectedValue = (scenarios, probabilities) => {\n  return (scenarios.bestCase * probabilities.bestCase / 100) +\n         (scenarios.mostLikely * probabilities.mostLikely / 100) +\n         (scenarios.worstCase * probabilities.worstCase / 100);\n};\n\n// Auto-normalize probabilities\nexport const normalizeProbabilities = (best, likely, worst) => {\n  const total = best + likely + worst;\n  if (total !== 100) {\n    const factor = 100 / total;\n    return {\n      best: Math.round(best * factor),\n      likely: Math.round(likely * factor),\n      worst: Math.round(worst * factor)\n    };\n  }\n  return { best, likely, worst };\n};\n\n// SBA minimum constraint\nexport const validateSBADownPayment = (value) => Math.max(value, 10);\n\n// Debt service coverage validation\nexport const validateDebtCoverage = (ebitda, debtService) => debtService / ebitda <= 0.8;\n\n// Generate bell curve data\nexport const generateBellCurve = (mean, min, max) => {\n  const stdDev = (max - min) / 6;\n  const points = [];\n  for (let x = min; x <= max; x += (max - min) / 100) {\n    const y = Math.exp(-0.5 * Math.pow((x - mean) / stdDev, 2));\n    points.push({ x, y });\n  }\n  return points;\n};\n\n// Calculate total cash required\nexport const calculateTotalCashRequired = (params) => {\n  const {\n    purchasePrice,\n    sbaDownPaymentPercent,\n    workingCapitalPercent,\n    targetRevenue,\n    techInvestment,\n    sellerFinancingPercent = 20, // Default seller financing percentage\n    dueDiligencePercent = 1.5,\n    professionalFeesPercent = 0.8,\n    contingencyPercent = 2.5\n  } = params;\n\n  // Calculate financing structure correctly\n  const sellerFinancingAmount = purchasePrice * (sellerFinancingPercent / 100);\n  const sbaLoanAmount = purchasePrice - sellerFinancingAmount;\n  const sbaDownPayment = sbaLoanAmount * (sbaDownPaymentPercent / 100);\n  \n  // Note: Total financing may exceed purchase price if both SBA and seller financing are used\n  // This is typical in SBA deals where seller financing is additional to SBA loan\n  \n  const workingCapital = targetRevenue * (workingCapitalPercent / 100);\n  const dueDiligence = purchasePrice * (dueDiligencePercent / 100);\n  const professionalFees = purchasePrice * (professionalFeesPercent / 100);\n  const contingency = purchasePrice * (contingencyPercent / 100);\n\n  return {\n    downPayment: sbaDownPayment,\n    workingCapital,\n    dueDiligence,\n    professionalFees,\n    techInvestment,\n    contingency,\n    total: sbaDownPayment + workingCapital + dueDiligence + professionalFees + techInvestment + contingency\n  };\n};\n\n// Calculate annual cash to pocket\nexport const calculateAnnualCashToPocket = (params) => {\n  const {\n    targetRevenue,\n    netProfitMarginPercent,\n    sbaLoanAmount,\n    sellerFinancingAmount,\n    managementSalary,\n    techInvestment\n  } = params;\n\n  const ebitda = targetRevenue * (netProfitMarginPercent / 100);\n  const sbaPayment = calculateSBAPayment(sbaLoanAmount);\n  const sellerPayment = calculateSellerPayment(sellerFinancingAmount);\n  const techInvestmentAmortized = techInvestment / 3; // Amortized over 3 years\n\n  return {\n    ebitda,\n    sbaPayment,\n    sellerPayment,\n    managementSalary,\n    techInvestmentAmortized,\n    netCashFlow: ebitda - sbaPayment - sellerPayment - managementSalary - techInvestmentAmortized\n  };\n};\n\n// Calculate Debt Service Coverage Ratio (DSCR)\nexport const calculateDSCR = (annualEBITDA, totalAnnualDebtService) => {\n  const result = totalAnnualDebtService > 0 ? annualEBITDA / totalAnnualDebtService : 0;\n  \n  if (DEBUG_METRICS) {\n    logMetricCalculation(\n      \"Business Health\",\n      \"DSCR (Debt Service Coverage Ratio)\",\n      {\n        annualEBITDA,\n        totalAnnualDebtService\n      },\n      \"DSCR = Annual EBITDA ÷ Total Annual Debt Service\",\n      result,\n      {\n        interpretation: result >= 1.25 ? \"Strong coverage\" : result >= 1.0 ? \"Adequate coverage\" : \"Weak coverage\",\n        calculation: `${annualEBITDA} ÷ ${totalAnnualDebtService} = ${result}x`\n      }\n    );\n  }\n  \n  return result;\n};\n\n// Calculate Cash-on-Cash Return\nexport const calculateCashOnCashReturn = (annualCashToPocket, personalCashInvested) => {\n  const result = personalCashInvested > 0 ? (annualCashToPocket / personalCashInvested) * 100 : 0;\n  \n  if (DEBUG_METRICS) {\n    logMetricCalculation(\n      \"Personal Returns\",\n      \"Cash-on-Cash Return\",\n      {\n        annualCashToPocket,\n        personalCashInvested\n      },\n      \"Cash-on-Cash Return = (Annual Cash to Pocket ÷ Personal Cash Invested) × 100\",\n      result,\n      {\n        interpretation: result >= 20 ? \"Excellent return\" : result >= 15 ? \"Good return\" : result >= 10 ? \"Fair return\" : \"Poor return\",\n        calculation: `(${annualCashToPocket} ÷ ${personalCashInvested}) × 100 = ${result}%`\n      }\n    );\n  }\n  \n  return result;\n};\n\n// Calculate IRR using Newton-Raphson method\nexport const calculateIRR = (personalInvestment, cashFlows) => {\n  const tolerance = 0.0001;\n  const maxIterations = 100;\n  let guess = 0.1; // Start with 10%\n\n  for (let i = 0; i < maxIterations; i++) {\n    let npv = -personalInvestment;\n    let derivative = 0;\n\n    for (let j = 0; j < cashFlows.length; j++) {\n      const discountFactor = Math.pow(1 + guess, j + 1);\n      npv += cashFlows[j] / discountFactor;\n      derivative -= (j + 1) * cashFlows[j] / (discountFactor * (1 + guess));\n    }\n\n    const newGuess = guess - npv / derivative;\n    \n    if (Math.abs(newGuess - guess) < tolerance) {\n      const result = newGuess * 100; // Return as percentage\n      \n      if (DEBUG_METRICS) {\n        logMetricCalculation(\n          \"Personal Returns\",\n          \"IRR (Internal Rate of Return)\",\n          {\n            personalInvestment,\n            cashFlows,\n            iterations: i + 1\n          },\n          \"IRR = Rate where NPV = 0 (calculated using Newton-Raphson method)\",\n          result,\n          {\n            method: \"Newton-Raphson iteration\",\n            tolerance: tolerance,\n            maxIterations: maxIterations,\n            interpretation: result >= 15 ? \"Excellent return\" : result >= 10 ? \"Good return\" : result >= 5 ? \"Fair return\" : \"Poor return\"\n          }\n        );\n      }\n      \n      return result;\n    }\n    \n    guess = newGuess;\n  }\n  \n  if (DEBUG_METRICS) {\n    logMetricCalculation(\n      \"Personal Returns\",\n      \"IRR (Internal Rate of Return)\",\n      {\n        personalInvestment,\n        cashFlows\n      },\n      \"IRR = Rate where NPV = 0 (calculated using Newton-Raphson method)\",\n      null,\n      {\n        method: \"Newton-Raphson iteration\",\n        tolerance: tolerance,\n        maxIterations: maxIterations,\n        error: \"No convergence - IRR calculation failed\"\n      }\n    );\n  }\n  \n  return null; // No convergence\n};\n\n// Calculate Multiple on Invested Capital (MOIC)\nexport const calculateMOIC = (personalCashInvested, fiveYearProjections) => {\n  const totalCashReturned = fiveYearProjections.reduce((sum, year) => sum + year.cashFlow, 0);\n  const businessValueAtExit = fiveYearProjections[4].ebitda * 4.2; // Assume same multiple\n  const result = (totalCashReturned + businessValueAtExit) / personalCashInvested;\n  \n  if (DEBUG_METRICS) {\n    logMetricCalculation(\n      \"Personal Returns\",\n      \"MOIC (Multiple on Invested Capital)\",\n      {\n        personalCashInvested,\n        totalCashReturned,\n        businessValueAtExit,\n        year5EBITDA: fiveYearProjections[4].ebitda,\n        exitMultiple: 4.2\n      },\n      \"MOIC = (Total Cash Returned + Business Value at Exit) ÷ Personal Cash Invested\",\n      result,\n      {\n        exitMultipleSource: \"Assumed 4.2x EBITDA exit multiple\",\n        calculation: `(${totalCashReturned} + ${businessValueAtExit}) ÷ ${personalCashInvested} = ${result}x`\n      }\n    );\n  }\n  \n  return result;\n};\n\n// Calculate Payback Period\nexport const calculatePaybackPeriod = (personalCashInvested, fiveYearProjections) => {\n  let cumulativeCashFlow = 0;\n  let result = '>5 years';\n  \n  for (let i = 0; i < fiveYearProjections.length; i++) {\n    cumulativeCashFlow += fiveYearProjections[i].cashFlow;\n    if (cumulativeCashFlow >= personalCashInvested) {\n      result = i + 1 + ((personalCashInvested - (cumulativeCashFlow - fiveYearProjections[i].cashFlow)) / fiveYearProjections[i].cashFlow);\n      break;\n    }\n  }\n  \n  if (DEBUG_METRICS) {\n    logMetricCalculation(\n      \"Personal Returns\",\n      \"Payback Period\",\n      {\n        personalCashInvested,\n        cumulativeCashFlow,\n        fiveYearProjections: fiveYearProjections.map(p => ({ year: p.year, cashFlow: p.cashFlow }))\n      },\n      \"Payback Period = Years until cumulative cash flow exceeds personal investment\",\n      result,\n      {\n        interpretation: typeof result === 'number' ? `${result} years to recover investment` : \"Investment not recovered within 5 years\",\n        calculation: `Cumulative cash flow: ${cumulativeCashFlow} vs Personal Investment: ${personalCashInvested}`\n      }\n    );\n  }\n  \n  return result;\n};\n\n// Enhanced Risk Score Calculation\nexport const calculateEnhancedRiskScore = (dscr, cashOnCash, sellerFinancingPercent) => {\n  let score = 5; // Base score\n  \n  // DSCR scoring\n  if (dscr >= 1.5) score += 2;\n  else if (dscr >= 1.25) score += 1;\n  else score -= 2;\n  \n  // Cash-on-Cash scoring\n  if (cashOnCash >= 20) score += 2;\n  else if (cashOnCash >= 15) score += 1;\n  else if (cashOnCash < 10) score -= 1;\n  \n  // Seller financing scoring\n  if (sellerFinancingPercent >= 20) score += 1; // Seller has skin in game\n  \n  const result = Math.max(1, Math.min(10, score));\n  \n  if (DEBUG_METRICS) {\n    logMetricCalculation(\n      \"Risk Assessment\",\n      \"Enhanced Risk Score\",\n      {\n        dscr,\n        cashOnCash,\n        sellerFinancingPercent\n      },\n      \"Risk Score = Base(5) + DSCR Bonus + Cash-on-Cash Bonus + Seller Financing Bonus\",\n      result,\n      {\n        baseScore: 5,\n        dscrContribution: dscr >= 1.5 ? 2 : dscr >= 1.25 ? 1 : -2,\n        cashOnCashContribution: cashOnCash >= 20 ? 2 : cashOnCash >= 15 ? 1 : cashOnCash < 10 ? -1 : 0,\n        sellerFinancingContribution: sellerFinancingPercent >= 20 ? 1 : 0,\n        interpretation: result <= 3 ? \"High Risk\" : result <= 6 ? \"Medium Risk\" : \"Low Risk\"\n      }\n    );\n  }\n  \n  return result;\n};\n\n// Calculate financing structure\nexport const calculateFinancingStructure = (params) => {\n  const {\n    purchasePrice,\n    sellerFinancingPercent,\n    sbaDownPaymentPercent\n  } = params;\n\n  const sellerFinancing = purchasePrice * (sellerFinancingPercent / 100);\n  const sbaLoanAmount = purchasePrice - sellerFinancing;\n  const downPayment = sbaLoanAmount * (sbaDownPaymentPercent / 100);\n\n  return {\n    purchasePrice,\n    sellerFinancing,\n    sbaLoanAmount,\n    downPayment\n  };\n};\n\n// Calculate 6-year projections for advanced metrics\nexport const calculateFiveYearProjections = (params) => {\n  const {\n    targetRevenue,\n    revenueGrowthRatePercent,\n    netProfitMarginPercent,\n    sbaLoanAmount,\n    sellerFinancingAmount,\n    managementSalary,\n    techInvestment,\n    sbaInterestRate = 11.5,\n    sellerInterestRate = 8\n  } = params;\n\n  const projections = [];\n  let currentRevenue = targetRevenue;\n\n  for (let year = 1; year <= 6; year++) {\n    const ebitda = currentRevenue * (netProfitMarginPercent / 100);\n    const sbaPayment = calculateSBAPayment(sbaLoanAmount, sbaInterestRate / 100, 10);\n    const sellerPayment = calculateSellerPayment(sellerFinancingAmount, sellerInterestRate / 100, 5);\n    const techInvestmentAmortized = year <= 3 ? techInvestment / 3 : 0;\n\n    const netCashFlow = ebitda - sbaPayment - sellerPayment - managementSalary - techInvestmentAmortized;\n\n    projections.push({\n      year,\n      revenue: currentRevenue,\n      ebitda,\n      cashFlow: netCashFlow\n    });\n\n    currentRevenue *= (1 + revenueGrowthRatePercent / 100);\n  }\n\n  return projections;\n};\n\n// Calculate business targeting metrics\nexport const calculateBusinessTargetingMetrics = (availableCash, targetRevenue) => {\n  return {\n    maxSafePurchasePrice: availableCash * 4, // Assuming 25% total cash requirement\n    minRequiredEBITDA: (availableCash * 4 * 0.12) / 1.25, // 12% debt service / 1.25x coverage\n    targetRevenueRange: {\n      min: targetRevenue * 0.8,\n      max: targetRevenue * 1.2\n    },\n    recommendedMultipleRange: {\n      min: 3.5,\n      max: 5.0\n    }\n  };\n};\n\n// Calculate risk score (1-10)\nexport const calculateRiskScore = (params) => {\n  let riskScore = 5; // Base score\n\n  // Debt service coverage ratio\n  const ebitda = params.targetRevenue * (params.netProfitMarginPercent / 100);\n  const sbaPayment = calculateSBAPayment(params.sbaLoanAmount);\n  const sellerPayment = calculateSellerPayment(params.sellerFinancingAmount);\n  const totalDebtService = sbaPayment + sellerPayment;\n  const debtCoverageRatio = ebitda / totalDebtService;\n\n  if (debtCoverageRatio < 1.25) riskScore += 3;\n  else if (debtCoverageRatio < 1.5) riskScore += 1;\n  else if (debtCoverageRatio > 2.0) riskScore -= 1;\n\n  // Working capital ratio\n  const workingCapitalRatio = (params.workingCapitalPercent / 100) / (params.netProfitMarginPercent / 100);\n  if (workingCapitalRatio > 0.8) riskScore += 2;\n  else if (workingCapitalRatio < 0.3) riskScore -= 1;\n\n  // SBA down payment\n  if (params.sbaDownPaymentPercent < 12) riskScore += 1;\n  else if (params.sbaDownPaymentPercent > 15) riskScore -= 1;\n\n  return Math.max(1, Math.min(10, riskScore));\n};\n\n// Calculate business-only WACC (excluding personal loans)\nexport const calculateBusinessWACC = (sbaLoan, sellerFinancing, purchasePrice) => {\n  const totalBusinessDebt = sbaLoan.amount + sellerFinancing.amount;\n  const businessEquity = purchasePrice - totalBusinessDebt;\n  const totalBusinessCapital = purchasePrice;\n  \n  if (totalBusinessCapital <= 0) return 0;\n  \n  const debtWeight = totalBusinessDebt / totalBusinessCapital;\n  const equityWeight = businessEquity / totalBusinessCapital;\n  \n  // Different tax treatment for different debt types\n  const sbaAfterTaxCost = 0.115 * 0.75; // 25% tax benefit for business-deductible SBA\n  const sellerAfterTaxCost = 0.08 * 0.9; // 10% tax benefit for seller financing (less deductible)\n  const afterTaxDebtCost = totalBusinessDebt > 0 ? \n    ((sbaLoan.amount * sbaAfterTaxCost + sellerFinancing.amount * sellerAfterTaxCost) / totalBusinessDebt) : 0;\n  const equityCost = 0.15; // Business equity cost\n  \n  return (debtWeight * afterTaxDebtCost) + (equityWeight * equityCost);\n};\n\n// Calculate business-level EVA (excluding personal loans)\nexport const calculateBusinessEVA = (businessEBITDA, businessCapitalInvested, businessWACC) => {\n  const taxRate = 0.25;\n  const nopat = businessEBITDA * (1 - taxRate); // Net Operating Profit After Tax\n  const capitalCharge = businessCapitalInvested * businessWACC;\n  return nopat - capitalCharge;\n};\n\n// Calculate business cash flow (company level only)\nexport const calculateBusinessCashFlow = (scenario, loanStructure, businessCapitalInvested) => {\n  const businessDebtService = \n    loanStructure.sbaLoan.annualPayment + \n    loanStructure.sellerFinancing.annualPayment;\n  \n  const businessFreeCashFlow = \n    scenario.ebitda - \n    businessDebtService - \n    scenario.managementSalary - \n    scenario.techInvestmentAnnual;\n  \n  const businessDSCR = businessDebtService > 0 ? scenario.ebitda / businessDebtService : 0;\n  \n  return {\n    businessRevenue: scenario.targetRevenue,\n    businessEBITDA: scenario.ebitda,\n    businessDebtService: businessDebtService,\n    businessFreeCashFlow: businessFreeCashFlow,\n    businessDSCR: businessDSCR,\n    businessROA: businessCapitalInvested > 0 ? (businessFreeCashFlow / businessCapitalInvested) * 100 : 0\n  };\n};\n\n// Calculate personal cash flow (owner level only)\nexport const calculatePersonalCashFlow = (businessCashFlow, personalLoans, ownershipData, fundingSources) => {\n  const ownerDistribution = businessCashFlow.businessFreeCashFlow * ownershipData.yourOwnership;\n  \n  const personalDebtService = \n    personalLoans.houseEquity.annualPayment + \n    personalLoans.taiwaneseLoan.annualPayment;\n  \n  const personalNetCashFlow = ownerDistribution - personalDebtService;\n  \n  const personalCashInvested = \n    (fundingSources.personalCash.enabled ? fundingSources.personalCash.amount : 0) + \n    (fundingSources.houseEquity.enabled ? fundingSources.houseEquity.amount : 0) + \n    (fundingSources.taiwaneseLoan.enabled ? fundingSources.taiwaneseLoan.amount : 0);\n  \n  const personalROI = personalCashInvested > 0 ? \n    (personalNetCashFlow / personalCashInvested) * 100 : 0;\n  \n  return {\n    ownerDistribution: ownerDistribution,\n    personalDebtService: personalDebtService,\n    personalNetCashFlow: personalNetCashFlow,\n    personalCashInvested: personalCashInvested,\n    personalROI: personalROI\n  };\n};\n\n// Calculate personal projections\nexport const calculatePersonalProjections = (businessProjections, personalLoans, ownershipData) => {\n  return businessProjections.map((year, index) => {\n    const businessFCF = year.businessFreeCashFlow;\n    const ownerDistribution = businessFCF * ownershipData.yourOwnership;\n    const personalDebtService = personalLoans.total;\n    const yourFCF = ownerDistribution - personalDebtService;\n    \n    return {\n      year: index + 1,\n      businessFCF: businessFCF,\n      ownerDistribution: ownerDistribution,\n      yourFCF: yourFCF,\n      DSCR: year.businessDSCR,\n      cumulative: index === 0 ? yourFCF : (index > 0 ? businessProjections[index - 1].cumulative : 0) + yourFCF\n    };\n  });\n};\n\n// Calculate risk-adjusted ownership with fair methodology\nexport const calculateRiskAdjustedOwnership = (fundingSources, managementValue = 150000) => {\n  // Calculate risk-weighted contributions\n  const personalCashRisk = fundingSources.personalCash.enabled ? fundingSources.personalCash.amount : 0;\n  \n  // Taiwanese loan: Personal guarantee = 80% risk weight\n  const taiwaneseLoanRisk = fundingSources.taiwaneseLoan.enabled ? \n    fundingSources.taiwaneseLoan.amount * 0.8 : 0;\n    \n  // Home equity: Personal asset at risk = 120% risk weight (higher risk premium)\n  const homeEquityRisk = fundingSources.houseEquity.enabled ? \n    fundingSources.houseEquity.amount * 1.2 : 0;\n    \n  // SBA loan: Personal guarantee but asset-backed = 30% risk weight\n  // const sbaRisk = 0; // SBA loan is debt, not equity contribution\n  \n  // Management/operational value (sweat equity)\n  const sweatEquityValue = managementValue;\n  \n  // Total personal risk-adjusted contribution\n  const personalRiskAdjusted = personalCashRisk + taiwaneseLoanRisk + homeEquityRisk + sweatEquityValue;\n  \n  // Outside investor contribution (100% risk weight)\n  const investorContribution = fundingSources.additionalInvestment.enabled ? \n    fundingSources.additionalInvestment.amount : 0;\n  \n  // Total risk-adjusted equity\n  const totalRiskAdjustedEquity = personalRiskAdjusted + investorContribution;\n  \n  // Base ownership calculation\n  const baseOwnership = totalRiskAdjustedEquity > 0 ? \n    personalRiskAdjusted / totalRiskAdjustedEquity : 1;\n  \n  // Dynamic control premium based on investor amount\n  const controlPremium = investorContribution > 0 ? \n    Math.min(0.05, investorContribution / 1000000) : 0; // Max 5%, scales with investment size\n  \n  // Final ownership (capped at 95% to be fair to investors)\n  const finalOwnership = Math.min(0.95, baseOwnership + controlPremium);\n  \n  return {\n    yourOwnership: finalOwnership,\n    investorOwnership: 1 - finalOwnership,\n    breakdown: {\n      personalCashRisk,\n      taiwaneseLoanRisk,\n      homeEquityRisk,\n      sweatEquityValue,\n      investorContribution,\n      controlPremium: controlPremium * 100\n    }\n  };\n};\n\n// Calculate ownership cash flows with preferred return structure\nexport const calculateOwnershipCashFlows = (totalBusinessCashFlow, ownershipData, fundingSources) => {\n  const investorAmount = fundingSources.additionalInvestment.enabled ? \n    fundingSources.additionalInvestment.amount : 0;\n  const personalCashAmount = fundingSources.personalCash.enabled ? \n    fundingSources.personalCash.amount : 0;\n  \n  // Investor preferred return (8% on their investment)\n  const investorPreferredReturn = investorAmount * 0.08;\n  \n  // Your preferred return (6% on personal cash)\n  const yourPreferredReturn = personalCashAmount * 0.06;\n  \n  // Total preferred returns\n  const totalPreferredReturns = investorPreferredReturn + yourPreferredReturn;\n  \n  // Remaining cash flow after preferred returns\n  const remainingCashFlow = Math.max(0, totalBusinessCashFlow - totalPreferredReturns);\n  \n  // Split remaining cash flow based on ownership percentages\n  const yourRemainingShare = remainingCashFlow * ownershipData.yourOwnership;\n  const investorRemainingShare = remainingCashFlow * ownershipData.investorOwnership;\n  \n  // Total distributions\n  const yourTotalCashFlow = yourPreferredReturn + yourRemainingShare;\n  const investorTotalCashFlow = investorPreferredReturn + investorRemainingShare;\n  \n  // Calculate ROI on actual cash invested (not risk-adjusted amounts)\n  const yourCashInvested = personalCashAmount;\n  const yourROI = yourCashInvested > 0 ? (yourTotalCashFlow / yourCashInvested) * 100 : 0;\n  \n  const investorROI = investorAmount > 0 ? (investorTotalCashFlow / investorAmount) * 100 : 0;\n  \n  return {\n    yourTotalCashFlow,\n    investorTotalCashFlow,\n    yourROI,\n    investorROI,\n    preferredReturns: {\n      yours: yourPreferredReturn,\n      investor: investorPreferredReturn\n    },\n    remainingCashFlowSplit: {\n      yours: yourRemainingShare,\n      investor: investorRemainingShare\n    }\n  };\n};\n\n// Validate ownership for reasonableness\nexport const validateOwnership = (ownershipData, fundingSources, businessMetrics) => {\n  const warnings = [];\n  \n  // Check if investor is getting fair deal\n  if (ownershipData.investorOwnership < 0.05 && fundingSources.additionalInvestment.amount > 50000) {\n    warnings.push(\"⚠️ Investor ownership very low - may not be attractive\");\n  }\n  \n  // Check if you're giving up too much\n  if (ownershipData.yourOwnership < 0.6 && fundingSources.personalCash.amount > fundingSources.additionalInvestment.amount) {\n    warnings.push(\"⚠️ Your ownership low despite majority funding\");\n  }\n  \n  // Check for reasonable investor return (simplified calculation)\n  const investorAmount = fundingSources.additionalInvestment.enabled ? fundingSources.additionalInvestment.amount : 0;\n  const expectedInvestorReturn = investorAmount > 0 ? (businessMetrics.totalCashFlow * ownershipData.investorOwnership / investorAmount) * 100 : 0;\n  if (expectedInvestorReturn < 15 && investorAmount > 0) {\n    warnings.push(\"⚠️ Investor expected return below market (15%+)\");\n  }\n  \n  return warnings;\n};\n\n// Verification function to test calculations with known values\nexport const verifyCalculations = (testScenario) => {\n  const {\n    targetRevenue = 2500000,\n    netProfitMargin = 25,\n    valuationMultiple = 4,\n    sbaLoanAmount = 1500000,\n    sellerFinancingAmount = 500000,\n    personalCash = 550000,\n    additionalInvestment = 100000\n  } = testScenario;\n\n  // Test business calculations\n  const ebitda = targetRevenue * (netProfitMargin / 100);\n  const purchasePrice = ebitda * valuationMultiple;\n  const businessCapitalInvested = purchasePrice + (targetRevenue * 0.1) + (purchasePrice * 0.015) + (purchasePrice * 0.008);\n  \n  // Test WACC\n  const businessWACC = calculateBusinessWACC(\n    { amount: sbaLoanAmount, rate: 0.115 },\n    { amount: sellerFinancingAmount, rate: 0.08 },\n    purchasePrice\n  );\n  \n  // Test EVA\n  const businessEVA = calculateBusinessEVA(ebitda, businessCapitalInvested, businessWACC);\n  \n  // Test ownership\n  const fundingSources = {\n    personalCash: { enabled: true, amount: personalCash },\n    taiwaneseLoan: { enabled: true, amount: 725000 },\n    houseEquity: { enabled: false, amount: 200000 },\n    additionalInvestment: { enabled: true, amount: additionalInvestment }\n  };\n  \n  const ownershipData = calculateRiskAdjustedOwnership(fundingSources);\n  \n  return {\n    testScenario: {\n      targetRevenue,\n      ebitda,\n      purchasePrice,\n      businessCapitalInvested,\n      businessWACC: businessWACC * 100,\n      businessEVA,\n      ownershipData\n    },\n    expectedRanges: {\n      businessWACC: { min: 7, max: 12 },\n      businessEVA: { min: 0, max: 200000 },\n      ownership: { min: 0.6, max: 0.95 }\n    }\n  };\n};\n\n// Format currency\nexport const formatCurrency = (amount) => {\n  return new Intl.NumberFormat('en-US', {\n    style: 'currency',\n    currency: 'USD',\n    minimumFractionDigits: 0,\n    maximumFractionDigits: 0,\n  }).format(amount);\n};\n\n// Format percentage\nexport const formatPercentage = (value) => {\n  return `${value.toFixed(1)}%`;\n}; \n\n// FUNDING PRIORITY ALLOCATION FUNCTIONS\n// Calculate total cash needed for acquisition\nexport const calculateTotalCashNeeded = (scenario, variables) => {\n  const purchasePrice = scenario.purchasePrice;\n  const workingCapitalPercent = variables.workingCapital || 14.6;\n  const workingCapital = scenario.targetRevenue * (workingCapitalPercent / 100);\n  const dueDiligence = purchasePrice * 0.015;\n  const professionalFees = purchasePrice * 0.008;\n  const contingency = purchasePrice * 0.025;\n  const techInvestment = variables.techInvestment || 100000;\n  \n  // Calculate SBA down payment correctly\n  const sellerFinancingPercent = variables.sellerFinancing || 20;\n  const sellerFinancingAmount = purchasePrice * (sellerFinancingPercent / 100);\n  const sbaLoanAmount = purchasePrice - sellerFinancingAmount;\n  const sbaDownPaymentPercent = variables.sbaDownPayment || 12;\n  const sbaDownPayment = sbaLoanAmount * (sbaDownPaymentPercent / 100);\n  \n  const totalCashNeeded = sbaDownPayment + workingCapital + dueDiligence + professionalFees + contingency + techInvestment;\n  \n  return {\n    purchasePrice,\n    workingCapital,\n    dueDiligence,\n    professionalFees,\n    contingency,\n    techInvestment,\n    sbaDownPayment,\n    totalCashNeeded\n  };\n};\n\n// Allocate funding by priority order (lowest to highest cost) - FOCUSED ON DOWN PAYMENT\nexport const allocateFundingByPriority = (downPaymentNeeded, fundingSources) => {\n  const allocation = {\n    taiwaneseLoan: 0,\n    personalCash: 0,\n    additionalInvestment: 0,\n    sellerFinancing: 0,\n    houseEquity: 0,\n    sbaLoan: 0\n  };\n  \n  let remainingDownPayment = downPaymentNeeded;\n  \n  // Priority 1: Taiwanese Loan (cheapest - 2.8%) - $300,000 available\n  if (fundingSources.taiwaneseLoan.enabled && remainingDownPayment > 0) {\n    const used = Math.min(remainingDownPayment, fundingSources.taiwaneseLoan.amount);\n    allocation.taiwaneseLoan = used;\n    remainingDownPayment -= used;\n  }\n  \n  // Priority 2: Personal Cash (8% opportunity cost) - $50,000 available\n  if (fundingSources.personalCash.enabled && remainingDownPayment > 0) {\n    const used = Math.min(remainingDownPayment, fundingSources.personalCash.amount);\n    allocation.personalCash = used;\n    remainingDownPayment -= used;\n  }\n  \n  // Priority 3: Additional Investment (15% expected return) - $50,000 available\n  if (fundingSources.additionalInvestment.enabled && remainingDownPayment > 0) {\n    const used = Math.min(remainingDownPayment, fundingSources.additionalInvestment.amount);\n    allocation.additionalInvestment = used;\n    remainingDownPayment -= used;\n  }\n  \n  // Priority 4: Seller Financing (8%) - $0 available (disabled)\n  if (fundingSources.sellerFinancing.enabled && remainingDownPayment > 0) {\n    const used = Math.min(remainingDownPayment, fundingSources.sellerFinancing.amount);\n    allocation.sellerFinancing = used;\n    remainingDownPayment -= used;\n  }\n  \n  // Priority 5: Home Equity Loan (8% but personal asset at risk) - $98,273 available\n  if (fundingSources.houseEquity.enabled && remainingDownPayment > 0) {\n    const used = Math.min(remainingDownPayment, fundingSources.houseEquity.amount);\n    allocation.houseEquity = used;\n    remainingDownPayment -= used;\n  }\n  \n  // Priority 6: SBA Loan (11.5% - highest cost, use as last resort) - $0 available (disabled)\n  if (remainingDownPayment > 0) {\n    allocation.sbaLoan = remainingDownPayment; // Whatever is left\n  }\n  \n  return {\n    allocation,\n    downPaymentGap: remainingDownPayment < 0 ? 0 : remainingDownPayment,\n    totalAllocated: downPaymentNeeded - Math.max(0, remainingDownPayment),\n    downPaymentNeeded: downPaymentNeeded,\n    remainingDownPayment: Math.max(0, remainingDownPayment)\n  };\n};\n\n// Determine purchase price financing structure\nexport const calculatePurchasePriceFinancing = (purchasePrice, fundingAllocation, variables) => {\n  // Seller financing reduces the amount that needs bank financing\n  const sellerFinancingAmount = fundingAllocation.allocation.sellerFinancing || 0;\n  const amountNeedingBankFinancing = purchasePrice - sellerFinancingAmount;\n  \n  // SBA loan covers remaining purchase price\n  const sbaLoanAmount = Math.max(0, amountNeedingBankFinancing);\n  const sbaDownPaymentPercent = Math.max(variables.sbaDownPayment || 10, 10);\n  const sbaDownPayment = sbaLoanAmount * (sbaDownPaymentPercent / 100);\n  const sbaLoanPrincipal = sbaLoanAmount - sbaDownPayment;\n  \n  return {\n    sellerFinancingAmount,\n    sbaLoanAmount,\n    sbaDownPayment,\n    sbaLoanPrincipal,\n    totalDownPaymentCovered: sbaDownPayment // This comes from cash allocation\n  };\n};\n\n// Calculate business debt service with priority allocation\nexport const calculateBusinessDebtService = (purchaseFinancing) => {\n  // Only SBA loan and seller financing create debt service for the business\n  const sbaAnnualPayment = calculateSBAPayment(\n    purchaseFinancing.sbaLoanPrincipal, \n    0.115, \n    10\n  );\n  \n  const sellerAnnualPayment = calculateSellerPayment(\n    purchaseFinancing.sellerFinancingAmount, \n    0.08, \n    5\n  );\n  \n  return {\n    sbaAnnualPayment,\n    sellerAnnualPayment,\n    totalBusinessDebtService: sbaAnnualPayment + sellerAnnualPayment\n  };\n};\n\n// Calculate personal debt service with priority allocation\nexport const calculatePersonalDebtService = (fundingAllocation) => {\n  // Only personal loans create personal debt service\n  const houseEquityPayment = fundingAllocation.allocation.houseEquity > 0 ? \n    calculateSBAPayment(fundingAllocation.allocation.houseEquity, 0.08, 15) : 0;\n    \n  const taiwanesePayment = fundingAllocation.allocation.taiwaneseLoan > 0 ? \n    calculateSBAPayment(fundingAllocation.allocation.taiwaneseLoan, 0.028, 10) : 0;\n  \n  return {\n    houseEquityPayment,\n    taiwanesePayment,\n    totalPersonalDebtService: houseEquityPayment + taiwanesePayment\n  };\n};\n\n// Calculate WACC with priority-based allocation - ALL FUNDING SOURCES\nexport const calculatePriorityBasedWACC = (fundingAllocation, purchasePrice) => {\n  // WACC should include ALL funding sources used for the business acquisition\n  // Each source has its own after-tax cost of capital\n  \n  let totalFunding = 0;\n  let weightedCost = 0;\n  \n  // After-tax cost rates for each funding source\n  const afterTaxCostRates = {\n    taiwaneseLoan: 0.028 * 0.75, // 2.8% × 0.75 = 2.1% after-tax (if business deductible)\n    personalCash: 0.08 * 0.75, // 8% × 0.75 = 6% after-tax (opportunity cost with tax benefit)\n    additionalInvestment: 0.15, // 15% equity cost (no tax benefit)\n    sellerFinancing: 0.08 * 0.75, // 8% × 0.75 = 6% after-tax\n    houseEquity: 0.08, // 8% (personal debt, no business tax benefit)\n    sbaLoan: 0.115 * 0.75 // 11.5% × 0.75 = 8.6% after-tax\n  };\n  \n  // Calculate weighted average cost of capital across all funding sources\n  Object.entries(fundingAllocation.allocation).forEach(([source, amount]) => {\n    if (amount > 0) {\n      totalFunding += amount;\n      weightedCost += amount * afterTaxCostRates[source];\n    }\n  });\n  \n  return totalFunding > 0 ? (weightedCost / totalFunding) * 100 : 0;\n};\n\n// Calculate ownership with priority-based allocation\nexport const calculatePriorityBasedOwnership = (fundingAllocation) => {\n  // Risk-adjusted personal contributions based on ACTUAL allocated amounts\n  const personalCashRisk = fundingAllocation.allocation.personalCash * 1.0;\n  const taiwaneseLoanRisk = fundingAllocation.allocation.taiwaneseLoan * 0.8; // Personal guarantee\n  const houseEquityRisk = fundingAllocation.allocation.houseEquity * 1.2; // Personal asset risk\n  \n  const totalPersonalRisk = personalCashRisk + taiwaneseLoanRisk + houseEquityRisk;\n  const investorContribution = fundingAllocation.allocation.additionalInvestment;\n  const totalEquity = totalPersonalRisk + investorContribution;\n  \n  const finalOwnership = totalEquity > 0 ? totalPersonalRisk / totalEquity : 1; // Removed control premium\n  \n  return {\n    yourOwnership: finalOwnership,\n    investorOwnership: 1 - finalOwnership,\n    breakdown: {\n      personalCashRisk,\n      taiwaneseLoanRisk,\n      houseEquityRisk,\n      investorContribution\n    }\n  };\n};\n\n// Calculate personal cost of capital (for personal funding sources)\nexport const calculatePersonalCostOfCapital = (fundingAllocation) => {\n  let totalPersonalFunding = 0;\n  let weightedPersonalCost = 0;\n  \n  // Only consider personal funding sources: Taiwanese Loan, Personal Cash, Home Equity\n  const personalCostRates = {\n    taiwaneseLoan: 0.028, // 2.8% - personal loan rate\n    personalCash: 0.08, // 8% opportunity cost\n    houseEquity: 0.08, // 8% home equity rate\n    // Excluded: additionalInvestment, sellerFinancing, sbaLoan (not personal funding)\n  };\n  \n  // Only calculate for personal funding sources\n  const personalSources = ['taiwaneseLoan', 'personalCash', 'houseEquity'];\n  \n  personalSources.forEach(source => {\n    const amount = fundingAllocation.allocation[source] || 0;\n    if (amount > 0) {\n      totalPersonalFunding += amount;\n      weightedPersonalCost += amount * personalCostRates[source];\n    }\n  });\n  \n  return totalPersonalFunding > 0 ? (weightedPersonalCost / totalPersonalFunding) * 100 : 0;\n};\n\n// Main scenario calculation with priority-based funding\nexport const calculateScenariosWithPriority = (targetRevenues, variables, fundingSources) => {\n  return targetRevenues.map(revenue => {\n    // Step 1: Calculate business metrics\n    const netMargin = variables.netProfitMargin || 25;\n    const valuationMultiple = variables.valuationMultiple || 4;\n    const ebitda = revenue * (netMargin / 100);\n    const purchasePrice = ebitda * valuationMultiple;\n    \n    // Log Purchase Price calculation\n    if (DEBUG_METRICS) {\n      logMetricCalculation(\n        \"Deal Structure\", \n        \"Purchase Price\",\n        {\n          targetRevenue: revenue,\n          netProfitMargin: netMargin,\n          valuationMultiple: valuationMultiple\n        },\n        \"Purchase Price = Target Revenue × Net Profit Margin × Valuation Multiple\",\n        purchasePrice,\n        {\n          netProfitMarginSource: \"User input assumption\",\n          valuationMultipleSource: \"Market multiple assumption\",\n          calculation: `${revenue} × ${netMargin}% × ${valuationMultiple}x = ${purchasePrice}`\n        }\n      );\n    }\n    \n    const businessMetrics = {\n      targetRevenue: revenue,\n      ebitda: ebitda,\n      purchasePrice: purchasePrice\n    };\n    \n    // Step 2: Calculate down payment needed (same logic as Scenario Comparison)\n    const downPaymentCalculation = calculateDownPaymentNeeded(businessMetrics, variables);\n    \n    // Log Down Payment calculation\n    if (DEBUG_METRICS) {\n      logMetricCalculation(\n        \"Deal Structure\",\n        \"Down Payment Needed\",\n        {\n          sbaDownPayment: downPaymentCalculation.sbaDownPayment,\n          workingCapital: downPaymentCalculation.workingCapital,\n          fees: downPaymentCalculation.fees\n        },\n        \"Down Payment = SBA Down Payment + Working Capital + Due Diligence + Professional Fees\",\n        downPaymentCalculation.downPaymentNeeded,\n        {\n          workingCapitalPercent: variables.workingCapital || 7.9,\n          dueDiligencePercent: 1.5,\n          professionalFeesPercent: 1.0,\n          calculation: `${downPaymentCalculation.sbaDownPayment} + ${downPaymentCalculation.workingCapital} + ${downPaymentCalculation.fees} = ${downPaymentCalculation.downPaymentNeeded}`\n        }\n      );\n    }\n    \n    // Step 3: Allocate funding by priority based on down payment needed\n    const fundingAllocation = allocateFundingByPriority(\n      downPaymentCalculation.downPaymentNeeded, \n      fundingSources\n    );\n    \n    // Step 4: Calculate purchase price financing\n    const purchaseFinancing = calculatePurchasePriceFinancing(\n      businessMetrics.purchasePrice, \n      fundingAllocation,\n      variables\n    );\n    \n    // Step 5: Calculate debt service\n    const businessDebtService = calculateBusinessDebtService(purchaseFinancing);\n    const personalDebtService = calculatePersonalDebtService(fundingAllocation);\n    \n    // Step 6: Calculate ownership, WACC, and personal cost of capital\n    const ownership = calculatePriorityBasedOwnership(fundingAllocation);\n    const wacc = calculatePriorityBasedWACC(fundingAllocation, businessMetrics.purchasePrice);\n    const personalCostOfCapital = calculatePersonalCostOfCapital(fundingAllocation);\n    \n    // Log WACC calculation\n    if (DEBUG_METRICS) {\n      logMetricCalculation(\n        \"Deal Structure\",\n        \"WACC\",\n        {\n          fundingAllocation: fundingAllocation.allocation,\n          purchasePrice: businessMetrics.purchasePrice\n        },\n        \"WACC = Σ(Weight × After-tax Rate) for all funding sources\",\n        wacc,\n        {\n          taxRate: 0.25,\n          afterTaxRates: \"Calculated based on funding source rates\",\n          calculation: `Weighted average of all funding source rates`\n        }\n      );\n    }\n    \n    // Log Personal Cost calculation\n    if (DEBUG_METRICS) {\n      logMetricCalculation(\n        \"Deal Structure\",\n        \"Your Personal Cost\",\n        {\n          personalFunding: {\n            taiwaneseLoan: fundingAllocation.allocation.taiwaneseLoan,\n            personalCash: fundingAllocation.allocation.personalCash,\n            houseEquity: fundingAllocation.allocation.houseEquity\n          },\n          personalCostOfCapital\n        },\n        \"Personal Cost = Weighted average of personal funding sources\",\n        personalCostOfCapital,\n        {\n          personalSources: \"Taiwanese Loan + Personal Cash + Home Equity\",\n          calculation: `Weighted average of personal funding rates`\n        }\n      );\n    }\n    \n    // Step 7: Calculate cash flows\n    const businessCashFlow = businessMetrics.ebitda - \n      businessDebtService.totalBusinessDebtService - \n      (variables.managementSalary || 100000) - \n      (variables.techInvestment || 100000) / 3;\n    \n    const ownerDistribution = businessCashFlow * ownership.yourOwnership;\n    const personalNetCashFlow = ownerDistribution - personalDebtService.totalPersonalDebtService;\n    \n    // Log Business Cash Flow calculation\n    if (DEBUG_METRICS) {\n      logMetricCalculation(\n        \"Business Health\",\n        \"Business Free Cash Flow\",\n        {\n          ebitda: businessMetrics.ebitda,\n          businessDebtService: businessDebtService.totalBusinessDebtService,\n          managementSalary: variables.managementSalary || 100000,\n          techInvestment: (variables.techInvestment || 100000) / 3\n        },\n        \"Business FCF = EBITDA - Business Debt Service - Management Salary - Tech Investment/3\",\n        businessCashFlow,\n        {\n          techInvestmentAmortization: \"Amortized over 3 years\",\n          calculation: `${businessMetrics.ebitda} - ${businessDebtService.totalBusinessDebtService} - ${variables.managementSalary || 100000} - ${(variables.techInvestment || 100000) / 3} = ${businessCashFlow}`\n        }\n      );\n    }\n    \n    // Log Personal Cash Flow calculation\n    if (DEBUG_METRICS) {\n      logMetricCalculation(\n        \"Personal Returns\",\n        \"Your Net Annual Gain\",\n        {\n          ownerDistribution,\n          personalDebtService: personalDebtService.totalPersonalDebtService,\n          yourOwnership: ownership.yourOwnership\n        },\n        \"Your Net Annual Gain = Owner Distribution - Personal Debt Service\",\n        personalNetCashFlow,\n        {\n          ownerDistributionCalculation: `Business FCF × Your Ownership %`,\n          calculation: `${ownerDistribution} - ${personalDebtService.totalPersonalDebtService} = ${personalNetCashFlow}`\n        }\n      );\n    }\n    \n    // Log ROI calculation\n    if (DEBUG_METRICS) {\n      const yourTotalCashInvested = fundingAllocation.allocation.personalCash + fundingAllocation.allocation.taiwaneseLoan + fundingAllocation.allocation.houseEquity;\n      const yourROI = (personalNetCashFlow / yourTotalCashInvested) * 100;\n      \n      logMetricCalculation(\n        \"Personal Returns\",\n        \"Your ROI\",\n        {\n          yourNetAnnualGain: personalNetCashFlow,\n          yourTotalCashInvested\n        },\n        \"Your ROI = (Your Net Annual Gain ÷ Your Total Cash Invested) × 100\",\n        yourROI,\n        {\n          yourCashInvestedComponents: \"Personal Cash + Taiwanese Loan + Home Equity\",\n          netAnnualGainComponents: \"Business Distribution - Personal Debt Service\",\n          calculation: `(${personalNetCashFlow} ÷ ${yourTotalCashInvested}) × 100 = ${yourROI}%`\n        }\n      );\n    }\n    \n    return {\n      ...businessMetrics,\n      ...downPaymentCalculation,\n      fundingAllocation,\n      purchaseFinancing,\n      businessDebtService,\n      personalDebtService,\n      ownership,\n      wacc,\n      personalCostOfCapital,\n      businessCashFlow,\n      ownerDistribution,\n      personalNetCashFlow,\n      personalROI: (personalNetCashFlow / (fundingAllocation.allocation.personalCash + fundingAllocation.allocation.taiwaneseLoan + fundingAllocation.allocation.houseEquity)) * 100\n    };\n  });\n}; \n\n// Calculate down payment needed using the same logic as Scenario Comparison\nexport const calculateDownPaymentNeeded = (scenario, variables) => {\n  const purchasePrice = scenario.purchasePrice;\n  \n  // Calculate SBA down payment\n  const sellerFinancingPercent = variables.sellerFinancing || 20;\n  const sellerFinancingAmount = purchasePrice * (sellerFinancingPercent / 100);\n  const sbaLoanAmount = purchasePrice - sellerFinancingAmount;\n  const sbaDownPaymentPercent = variables.sbaDownPayment || 12;\n  const sbaDownPayment = sbaLoanAmount * (sbaDownPaymentPercent / 100);\n  \n  // Calculate working capital and fees (same as Scenario Comparison)\n  const workingCapitalPercent = variables.workingCapital || 7.9;\n  const workingCapital = scenario.targetRevenue * (workingCapitalPercent / 100);\n  const fees = purchasePrice * 0.025; // 2.5% total fees (due diligence + professional fees)\n  \n  // Down Payment Needed = SBA Down Payment + Working Capital + Fees\n  const downPaymentNeeded = sbaDownPayment + workingCapital + fees;\n  \n  return {\n    sbaDownPayment,\n    workingCapital,\n    fees,\n    downPaymentNeeded\n  };\n}; \n\n// NEW METRICS CALCULATIONS\n\n// Capital Utilization Rate\nexport const calculateCapitalUtilizationRate = (totalAllocated, availableCash) => {\n  return availableCash > 0 ? (totalAllocated / availableCash) * 100 : 0;\n};\n\nexport const getCapitalUtilizationStatus = (rate) => {\n  if (rate > 95) return { color: '#E74C3C', level: 'critical', label: 'Critical' };\n  if (rate > 85) return { color: '#F1C40F', level: 'below-target', label: 'Below Target' };\n  if (rate > 65) return { color: '#27AE60', level: 'good', label: 'Good' };\n  return { color: '#3498DB', level: 'excellent', label: 'Excellent' };\n};\n\n// Leverage Multiplier\nexport const calculateLeverageMultiplier = (totalInvestment, personalCashInvested) => {\n  const result = personalCashInvested > 0 ? totalInvestment / personalCashInvested : 0;\n  \n  if (DEBUG_METRICS) {\n    logMetricCalculation(\n      \"Deal Structure\",\n      \"Leverage Multiplier\",\n      {\n        totalInvestment,\n        personalCashInvested\n      },\n      \"Leverage Multiplier = Total Investment ÷ Personal Cash Invested\",\n      result,\n      {\n        interpretation: result >= 8 ? \"Excellent leverage\" : result >= 5 ? \"Good leverage\" : result >= 3 ? \"Fair leverage\" : \"Poor leverage\",\n        calculation: `${totalInvestment} ÷ ${personalCashInvested} = ${result}x`\n      }\n    );\n  }\n  \n  return result;\n};\n\nexport const getLeverageMultiplierStatus = (multiplier) => {\n  if (multiplier < 3) return { color: '#E74C3C', level: 'critical', label: 'Critical' };\n  if (multiplier < 5) return { color: '#F1C40F', level: 'below-target', label: 'Below Target' };\n  if (multiplier < 8) return { color: '#27AE60', level: 'good', label: 'Good' };\n  return { color: '#3498DB', level: 'excellent', label: 'Excellent' };\n};\n\n// Price-to-Revenue Ratio\nexport const calculatePriceToRevenueRatio = (purchasePrice, targetRevenue) => {\n  return targetRevenue > 0 ? purchasePrice / targetRevenue : 0;\n};\n\nexport const getPriceToRevenueStatus = (ratio) => {\n  if (ratio > 1.2) return { color: '#E74C3C', level: 'critical', label: 'Critical' };\n  if (ratio > 1.0) return { color: '#F1C40F', level: 'below-target', label: 'Below Target' };\n  if (ratio > 0.8) return { color: '#27AE60', level: 'good', label: 'Good' };\n  return { color: '#3498DB', level: 'excellent', label: 'Excellent' };\n};\n\n// EBITDA Margin\nexport const calculateEBITDAMargin = (ebitda, revenue) => {\n  return revenue > 0 ? (ebitda / revenue) * 100 : 0;\n};\n\nexport const getEBITDAMarginStatus = (margin) => {\n  if (margin < 15) return { color: '#E74C3C', level: 'critical', label: 'Critical' };\n  if (margin < 18) return { color: '#F1C40F', level: 'below-target', label: 'Below Target' };\n  if (margin < 22) return { color: '#27AE60', level: 'good', label: 'Good' };\n  return { color: '#3498DB', level: 'excellent', label: 'Excellent' };\n};\n\n// Business Cash Conversion\nexport const calculateBusinessCashConversion = (businessFreeCashFlow, businessEBITDA) => {\n  return businessEBITDA > 0 ? (businessFreeCashFlow / businessEBITDA) * 100 : 0;\n};\n\nexport const getCashConversionStatus = (conversion) => {\n  if (conversion < 15) return { color: '#E74C3C', level: 'critical', label: 'Critical' };\n  if (conversion < 20) return { color: '#F1C40F', level: 'below-target', label: 'Below Target' };\n  if (conversion < 30) return { color: '#27AE60', level: 'good', label: 'Good' };\n  return { color: '#3498DB', level: 'excellent', label: 'Excellent' };\n};\n\n// Revenue-to-Investment Efficiency\nexport const calculateRevenueToInvestmentEfficiency = (targetRevenue, yourTotalInvestment) => {\n  return yourTotalInvestment > 0 ? targetRevenue / yourTotalInvestment : 0;\n};\n\nexport const getRevenueEfficiencyStatus = (efficiency) => {\n  if (efficiency < 3) return { color: '#E74C3C', level: 'critical', label: 'Critical' };\n  if (efficiency < 4) return { color: '#F1C40F', level: 'below-target', label: 'Below Target' };\n  if (efficiency < 6) return { color: '#27AE60', level: 'good', label: 'Good' };\n  return { color: '#3498DB', level: 'excellent', label: 'Excellent' };\n};\n\n// Risk-Adjusted Return\nexport const calculateRiskAdjustedReturn = (yourROI, riskFreeRate = 4.5, riskScore) => {\n  const result = riskScore > 0 ? (yourROI - riskFreeRate) / riskScore : 0;\n  \n  if (DEBUG_METRICS) {\n    logMetricCalculation(\n      \"Personal Returns\",\n      \"Risk-Adjusted Return\",\n      {\n        yourROI,\n        riskFreeRate,\n        riskScore\n      },\n      \"Risk-Adjusted Return = (Your ROI - Risk-Free Rate) ÷ Risk Score\",\n      result,\n      {\n        interpretation: result >= 1.5 ? \"Excellent risk-adjusted return\" : result >= 1.0 ? \"Good risk-adjusted return\" : result >= 0.5 ? \"Fair risk-adjusted return\" : \"Poor risk-adjusted return\",\n        calculation: `(${yourROI} - ${riskFreeRate}) ÷ ${riskScore} = ${result}`\n      }\n    );\n  }\n  \n  return result;\n};\n\nexport const getRiskAdjustedStatus = (ratio) => {\n  if (ratio < 0.5) return { color: '#E74C3C', level: 'critical', label: 'Critical' };\n  if (ratio < 1.0) return { color: '#F1C40F', level: 'below-target', label: 'Below Target' };\n  if (ratio < 1.5) return { color: '#27AE60', level: 'good', label: 'Good' };\n  return { color: '#3498DB', level: 'excellent', label: 'Excellent' };\n};\n\n// Income Replacement Ratio\nexport const calculateIncomeReplacementRatio = (yourNetAnnualGain, currentSalary) => {\n  const result = currentSalary > 0 ? (yourNetAnnualGain / currentSalary) * 100 : 0;\n  \n  if (DEBUG_METRICS) {\n    logMetricCalculation(\n      \"Personal Returns\",\n      \"W-2 Replacement\",\n      {\n        yourNetAnnualGain,\n        currentSalary\n      },\n      \"W-2 Replacement = (Your Net Annual Gain ÷ Current Salary) × 100\",\n      result,\n      {\n        interpretation: result >= 120 ? \"Excellent replacement\" : result >= 80 ? \"Good replacement\" : result >= 40 ? \"Fair replacement\" : \"Poor replacement\",\n        calculation: `(${yourNetAnnualGain} ÷ ${currentSalary}) × 100 = ${result}%`\n      }\n    );\n  }\n  \n  return result;\n};\n\nexport const getIncomeReplacementStatus = (ratio) => {\n  if (ratio < 40) return { color: '#E74C3C', level: 'critical', label: 'Critical' };\n  if (ratio < 80) return { color: '#F1C40F', level: 'below-target', label: 'Below Target' };\n  if (ratio < 120) return { color: '#27AE60', level: 'good', label: 'Good' };\n  return { color: '#3498DB', level: 'excellent', label: 'Excellent' };\n};\n\n// Wealth Building Velocity\nexport const calculateWealthBuildingVelocity = (totalReturnMultiple, investmentPeriod = 5) => {\n  const annualWealthCreation = Math.pow(totalReturnMultiple, 1/investmentPeriod) - 1;\n  const result = annualWealthCreation * 100;\n  \n  if (DEBUG_METRICS) {\n    logMetricCalculation(\n      \"Personal Returns\",\n      \"Wealth Velocity\",\n      {\n        totalReturnMultiple,\n        investmentPeriod\n      },\n      \"Wealth Velocity = Annual wealth creation rate from total return multiple\",\n      result,\n      {\n        interpretation: result >= 80 ? \"Excellent velocity\" : result >= 40 ? \"Good velocity\" : result >= 20 ? \"Fair velocity\" : \"Poor velocity\",\n        calculation: `Annual wealth creation from ${totalReturnMultiple}x return over ${investmentPeriod} years = ${result}%`\n      }\n    );\n  }\n  \n  return result;\n};\n\nexport const getWealthVelocityStatus = (velocity) => {\n  if (velocity < 20) return { color: '#E74C3C', level: 'critical', label: 'Critical' };\n  if (velocity < 40) return { color: '#F1C40F', level: 'below-target', label: 'Below Target' };\n  if (velocity < 80) return { color: '#27AE60', level: 'good', label: 'Good' };\n  return { color: '#3498DB', level: 'excellent', label: 'Excellent' };\n};\n\n// 6-Year Exit Value Range\nexport const calculateExitValueRange = (year6EBITDA, yourOwnership, conservativeMultiple = 3.0, expectedMultiple = 3.59, optimisticMultiple = 4.5) => {\n  return {\n    conservative: year6EBITDA * conservativeMultiple * yourOwnership,\n    expected: year6EBITDA * expectedMultiple * yourOwnership,\n    optimistic: year6EBITDA * optimisticMultiple * yourOwnership\n  };\n};\n\n// Stress Test Results\nexport const calculateStressTestResults = (baseROI, revenueStress = -20, marginStress = -300, rateStress = 200) => {\n  // Simplified stress test calculations\n  const revenueStressROI = baseROI * (1 + revenueStress / 100);\n  const marginStressROI = baseROI * (1 + marginStress / 10000); // basis points\n  const rateStressROI = baseROI * (1 - rateStress / 10000); // basis points\n  \n  const minROI = Math.min(revenueStressROI, marginStressROI, rateStressROI);\n  \n  return {\n    revenueStressROI,\n    marginStressROI,\n    rateStressROI,\n    minROI\n  };\n};\n\nexport const getStressTestStatus = (minROI) => {\n  if (minROI < 5) return { color: '#E74C3C', level: 'critical', label: 'Critical' };\n  if (minROI < 7) return { color: '#F1C40F', level: 'below-target', label: 'Below Target' };\n  if (minROI < 10) return { color: '#27AE60', level: 'good', label: 'Good' };\n  return { color: '#3498DB', level: 'excellent', label: 'Excellent' };\n};\n\n// Growth Funding Capacity\nexport const calculateGrowthFundingCapacity = (maxSustainableDebt, currentTotalDebt, projectedYear3CashFlow, leverageMultiplier) => {\n  const currentDebtCapacity = maxSustainableDebt - currentTotalDebt;\n  const cashFlowGrowthCapacity = projectedYear3CashFlow * leverageMultiplier;\n  return Math.min(currentDebtCapacity, cashFlowGrowthCapacity);\n};\n\nexport const getGrowthCapacityStatus = (capacity) => {\n  if (capacity < 50000) return { color: '#E74C3C', level: 'critical', label: 'Critical' };\n  if (capacity < 100000) return { color: '#F1C40F', level: 'below-target', label: 'Below Target' };\n  if (capacity < 200000) return { color: '#27AE60', level: 'good', label: 'Good' };\n  return { color: '#3498DB', level: 'excellent', label: 'Excellent' };\n}; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}